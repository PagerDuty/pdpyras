
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>PDPYRAS: PagerDuty Python REST API Sessions &#8212; PagerDuty Python REST API Sessions 4.1.3 documentation</title>
    <link rel="stylesheet" href="_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/language_data.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="section" id="pdpyras-pagerduty-python-rest-api-sessions">
<h1>PDPYRAS: PagerDuty Python REST API Sessions<a class="headerlink" href="#pdpyras-pagerduty-python-rest-api-sessions" title="Permalink to this headline">¶</a></h1>
<p>A minimal, practical Python client for the PagerDuty REST API.</p>
<p><a class="reference external" href="https://circleci.com/gh/PagerDuty/pdpyras"><img alt="circleci-build" src="https://circleci.com/gh/PagerDuty/pdpyras.svg?style=svg" /></a></p>
<ul class="simple">
<li><p><a class="reference external" href="https://github.com/PagerDuty/pdpyras">GitHub repository</a></p></li>
<li><p><a class="reference external" href="https://pagerduty.github.io/pdpyras">Documentation</a></p></li>
</ul>
<div class="section" id="about">
<h2>About<a class="headerlink" href="#about" title="Permalink to this headline">¶</a></h2>
<p>This library supplies a class <a class="reference internal" href="#pdpyras.APISession" title="pdpyras.APISession"><code class="xref py py-class docutils literal notranslate"><span class="pre">pdpyras.APISession</span></code></a> extending
<a class="reference external" href="https://2.python-requests.org/en/master/api/#request-sessions">requests.Session</a> from the <a class="reference external" href="https://2.python-requests.org/en/master/">Requests</a> HTTP library. It serves as a practical
and simple-as-possible-but-no-simpler HTTP client for accessing the PagerDuty
REST API and events API.</p>
<p>It takes care of all of the most common prerequisites and necessities
pertaining to accessing the API so that implementers can focus on the request
and response body schemas of each particular resource (as documented in our
<a class="reference external" href="https://developer.pagerduty.com/api-reference/">REST API Reference</a>) and do what they need to get done.</p>
<div class="section" id="features">
<h3>Features<a class="headerlink" href="#features" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Efficient API access through automatic HTTP connection pooling and
persistence</p></li>
<li><p>Tested in / support for Python 2.7 through 3.8</p></li>
<li><p>Configurable cooldown/reattempt logic for rate limiting and transient network
problems</p></li>
<li><p>Inclusion of required <a class="reference external" href="https://v2.developer.pagerduty.com/docs/rest-api#http-request-headers">HTTP Request Headers</a> for PagerDuty REST API requests</p></li>
<li><p>Bulk data retrieval and iteration over <a class="reference external" href="https://v2.developer.pagerduty.com/docs/endpoints#resources-index">resource index</a> endpoints with
pagination</p></li>
<li><p>Individual object retrieval by name</p></li>
<li><p>API request profiling</p></li>
<li><p>Bonus Events API client</p></li>
</ul>
</div>
<div class="section" id="history">
<h3>History<a class="headerlink" href="#history" title="Permalink to this headline">¶</a></h3>
<p>This module was borne of necessity for a basic, reusable API client to
eliminate code duplication in some of PagerDuty Support’s internal Python-based
API tools. We needed something that could get the job done without reinventing
the wheel or getting in the way.</p>
<p>We also frequently found ourselves performing REST API requests using beta or
non-documented API endpoints for one reason or another, so we also needed a
client that provided easy access to features of the underlying HTTP library
(i.e. to obtain the response headers, or set special request headers). We
needed something that eliminated tedious tasks like querying, <a class="reference external" href="https://v2.developer.pagerduty.com/docs/pagination">pagination</a> and
header-setting commonly associated with REST API usage. Finally, we discovered
that the way we were using <a class="reference external" href="https://2.python-requests.org/en/master/">requests</a> wasn’t making use of connection re-use,
and wanted a way to easily enforce this as a standard practice.</p>
<p>Ultimately, we deemed most other libraries to be both overkill for this task
and also not very conducive to use for experimental API calls.</p>
</div>
<div class="section" id="copyright">
<h3>Copyright<a class="headerlink" href="#copyright" title="Permalink to this headline">¶</a></h3>
<p>All the code in this distribution is Copyright (c) 2018 PagerDuty.</p>
<p><code class="docutils literal notranslate"><span class="pre">pdpyras</span></code> is made available under the MIT License:</p>
<blockquote>
<div><p>Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the “Software”), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:</p>
<p>The above copyright notice and this permission notice shall be included in
all copies or substantial portions of the Software.</p>
<p>THE SOFTWARE IS PROVIDED “AS IS”, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
THE SOFTWARE.</p>
</div></blockquote>
</div>
<div class="section" id="warranty">
<h3>Warranty<a class="headerlink" href="#warranty" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><p>THE SOFTWARE IS PROVIDED “AS IS”, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
THE SOFTWARE.</p>
</div></blockquote>
</div>
</div>
<div class="section" id="installation">
<h2>Installation<a class="headerlink" href="#installation" title="Permalink to this headline">¶</a></h2>
<p>If <code class="docutils literal notranslate"><span class="pre">pip</span></code> is available, it can be installed via:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pip</span> <span class="n">install</span> <span class="n">pdpyras</span>
</pre></div>
</div>
<p>Alternately, if <a class="reference external" href="https://2.python-requests.org/en/master/">requests</a> has already been installed locally, and <code class="docutils literal notranslate"><span class="pre">urllib3</span></code>
is available, one can simply download <a class="reference external" href="https://raw.githubusercontent.com/PagerDuty/pdpyras/master/pdpyras.py">pdpyras.py</a> into the directory where it
will be used.</p>
</div>
<div class="section" id="usage-guide">
<h2>Usage Guide<a class="headerlink" href="#usage-guide" title="Permalink to this headline">¶</a></h2>
<div class="section" id="basic-usage">
<h3>Basic Usage<a class="headerlink" href="#basic-usage" title="Permalink to this headline">¶</a></h3>
<p>Some examples of usage:</p>
<p><strong>Basic getting:</strong> Obtain a user profile as a dict object:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pdpyras</span> <span class="kn">import</span> <span class="n">APISession</span>
<span class="n">api_token</span> <span class="o">=</span> <span class="s1">&#39;your-token-here&#39;</span>
<span class="n">session</span> <span class="o">=</span> <span class="n">APISession</span><span class="p">(</span><span class="n">api_token</span><span class="p">)</span>

<span class="c1"># Using requests.Session.get:</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;/users/PABC123&#39;</span><span class="p">)</span>
<span class="n">user</span> <span class="o">=</span> <span class="kc">None</span>
<span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">ok</span><span class="p">:</span>
    <span class="n">user</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()[</span><span class="s1">&#39;user&#39;</span><span class="p">]</span>

<span class="c1"># Or, more succinctly:</span>
<span class="n">user</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">rget</span><span class="p">(</span><span class="s1">&#39;/users/PABC123&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>Iteration (1):</strong> Iterate over all users and print their ID, email and name:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pdpyras</span> <span class="kn">import</span> <span class="n">APISession</span>
<span class="n">api_token</span> <span class="o">=</span> <span class="s1">&#39;your-token-here&#39;</span>
<span class="n">session</span> <span class="o">=</span> <span class="n">APISession</span><span class="p">(</span><span class="n">api_token</span><span class="p">)</span>
<span class="k">for</span> <span class="n">user</span> <span class="ow">in</span> <span class="n">session</span><span class="o">.</span><span class="n">iter_all</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">user</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">],</span> <span class="n">user</span><span class="p">[</span><span class="s1">&#39;email&#39;</span><span class="p">],</span> <span class="n">user</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">])</span>
</pre></div>
</div>
<p><strong>Iteration (2):</strong> Compile a list of all services with “SN” in their name:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pdpyras</span> <span class="kn">import</span> <span class="n">APISession</span>
<span class="n">api_token</span> <span class="o">=</span> <span class="s1">&#39;your-token-here&#39;</span>
<span class="n">session</span> <span class="o">=</span> <span class="n">APISession</span><span class="p">(</span><span class="n">api_token</span><span class="p">)</span>
<span class="n">services</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">session</span><span class="o">.</span><span class="n">iter_all</span><span class="p">(</span><span class="s1">&#39;services&#39;</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;query&#39;</span><span class="p">:</span> <span class="s1">&#39;SN&#39;</span><span class="p">}))</span>
</pre></div>
</div>
<p><strong>Querying and updating:</strong> Find a user exactly matching email address <code class="docutils literal notranslate"><span class="pre">jane&#64;example35.com</span></code>
and update their name to “Jane Doe”:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pdpyras</span> <span class="kn">import</span> <span class="n">APISession</span>
<span class="n">api_token</span> <span class="o">=</span> <span class="s1">&#39;your-token-here&#39;</span>
<span class="n">session</span> <span class="o">=</span> <span class="n">APISession</span><span class="p">(</span><span class="n">api_token</span><span class="p">)</span>
<span class="n">user</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">,</span> <span class="s1">&#39;jane@example35.com&#39;</span><span class="p">,</span> <span class="n">attribute</span><span class="o">=</span><span class="s1">&#39;email&#39;</span><span class="p">)</span>
<span class="k">if</span> <span class="n">user</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
    <span class="c1"># Update using put directly:</span>
    <span class="n">updated_user</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">user</span><span class="p">[</span><span class="s1">&#39;self&#39;</span><span class="p">],</span> <span class="n">json</span><span class="o">=</span><span class="p">{</span>
        <span class="s1">&#39;user&#39;</span><span class="p">:{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span><span class="s1">&#39;user&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Jane Doe&#39;</span><span class="p">}</span>
    <span class="p">})</span>
    <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">ok</span><span class="p">:</span>
        <span class="n">updated_user</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()[</span><span class="s1">&#39;user&#39;</span><span class="p">]</span>

    <span class="c1"># Alternately / more succinctly:</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">updated_user</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">rput</span><span class="p">(</span><span class="n">user</span><span class="p">[</span><span class="s1">&#39;self&#39;</span><span class="p">],</span> <span class="n">json</span><span class="o">=</span><span class="p">{</span>
            <span class="s1">&#39;type&#39;</span><span class="p">:</span><span class="s1">&#39;user&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Jane Doe&#39;</span>
        <span class="p">})</span>
    <span class="k">except</span> <span class="n">PDClientError</span><span class="p">:</span>
        <span class="n">updated_user</span> <span class="o">=</span> <span class="kc">None</span>
</pre></div>
</div>
<p><strong>Multiple update:</strong> acknowledge all triggered incidents assigned to user with
ID <code class="docutils literal notranslate"><span class="pre">PHIJ789</span></code>. Note that to acknowledge, we need to set the <code class="docutils literal notranslate"><span class="pre">From</span></code> header.
This example assumes that <code class="docutils literal notranslate"><span class="pre">admin&#64;example.com</span></code> corresponds to a user in the
PagerDuty account:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pdpyras</span> <span class="kn">import</span> <span class="n">APISession</span>
<span class="n">api_token</span> <span class="o">=</span> <span class="s1">&#39;your-token-here&#39;</span>
<span class="n">session</span> <span class="o">=</span> <span class="n">APISession</span><span class="p">(</span><span class="n">api_token</span><span class="p">,</span> <span class="n">default_from</span><span class="o">=</span><span class="s1">&#39;admin@example.com&#39;</span><span class="p">)</span>
<span class="c1"># Query incidents</span>
<span class="n">incidents</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">list_all</span><span class="p">(</span>
    <span class="s1">&#39;incidents&#39;</span><span class="p">,</span>
    <span class="n">params</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;user_ids[]&#39;</span><span class="p">:[</span><span class="s1">&#39;PHIJ789&#39;</span><span class="p">],</span><span class="s1">&#39;statuses[]&#39;</span><span class="p">:[</span><span class="s1">&#39;triggered&#39;</span><span class="p">]}</span>
<span class="p">)</span>
<span class="c1"># Change their state</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">incidents</span><span class="p">:</span>
    <span class="n">i</span><span class="p">[</span><span class="s1">&#39;status&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;acknowledged&#39;</span>
<span class="c1"># PUT the updated list back up to the API</span>
<span class="n">updated_incidents</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">rput</span><span class="p">(</span><span class="s1">&#39;incidents&#39;</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="n">incidents</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="using-an-oauth-2-access-token-to-authenticate">
<h3>Using an OAuth 2 Access Token to Authenticate<a class="headerlink" href="#using-an-oauth-2-access-token-to-authenticate" title="Permalink to this headline">¶</a></h3>
<p>When using an OAuth2 token, include the keyword argument <code class="docutils literal notranslate"><span class="pre">auth_type='oauth2'</span></code>
or <code class="docutils literal notranslate"><span class="pre">auth_type='bearer'</span></code> to the constructor. This tells the client to set the
<code class="docutils literal notranslate"><span class="pre">Authorization</span></code> header appropriately in order to use this type of API
credential.</p>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pdpyras</span> <span class="kn">import</span> <span class="n">APISession</span>
<span class="n">session</span> <span class="o">=</span> <span class="n">APISession</span><span class="p">(</span><span class="n">oauth_token_here</span><span class="p">,</span> <span class="n">auth_type</span><span class="o">=</span><span class="s1">&#39;oauth2&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Note, obtaining an access token via the OAuth 2 flow is outside the purview of
an API client, and should be performed separately by your application.</p>
<p>For further information on OAuth 2 authentication with PagerDuty, refer to the
official documentation:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://v2.developer.pagerduty.com/docs/oauth-2-functionality">OAuth 2 Functionality</a></p></li>
<li><p><a class="reference external" href="https://v2.developer.pagerduty.com/docs/oauth-2-functionality-pkce">OAuth 2: PKCE Flow</a></p></li>
<li><p><a class="reference external" href="https://v2.developer.pagerduty.com/docs/oauth-2-functionality-client-secret">OAuth 2: Authorization Code Grant Flow</a></p></li>
</ul>
</div>
<div class="section" id="general-concepts">
<h3>General Concepts<a class="headerlink" href="#general-concepts" title="Permalink to this headline">¶</a></h3>
<p>In all cases, when sending or receiving data through the REST API using
<code class="docutils literal notranslate"><span class="pre">pdpyras.APISession</span></code>, note the following:</p>
<div class="section" id="urls">
<h4>URLs<a class="headerlink" href="#urls" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><p><strong>There is no need to include the API base URL.</strong> Any path relative to the web
root, leading slash or no, is automatically appended to the base URL when
constructing an API request, i.e. one can specify <code class="docutils literal notranslate"><span class="pre">users/PABC123</span></code> or
<code class="docutils literal notranslate"><span class="pre">/users/PABC123</span></code> instead of <code class="docutils literal notranslate"><span class="pre">https://api.pagerduty.com/users/PABC123</span></code>.</p></li>
<li><p>One can also pass the full URL of an API endpoint and it will still work, i.e.
the <code class="docutils literal notranslate"><span class="pre">self</span></code> property of any object can be used, and there is no need to strip
out the API base URL.</p></li>
</ul>
</div>
<div class="section" id="request-and-response-bodies">
<h4>Request and Response Bodies<a class="headerlink" href="#request-and-response-bodies" title="Permalink to this headline">¶</a></h4>
<p>Note that when working with the REST API using <code class="docutils literal notranslate"><span class="pre">pdpyras.APISession</span></code>, the
implementer is not insulated from having to work directly with the schemas of
requests and responses. Rather, one must follow the <a class="reference external" href="https://developer.pagerduty.com/api-reference/">REST API Reference</a> which
documents the schemas at length, and construct/access objects representing the
request and response bodies, while the API client takes care of everything else.</p>
<ul class="simple">
<li><p>Data is represented as dictionary or list  objects, and should have a
structure that mirrors that of the API schema:</p>
<ul>
<li><p>If the data type documented in the schema is
<a class="reference external" href="https://v2.developer.pagerduty.com/docs/types#object">object</a>, then the
corresponding type in Python will be <code class="docutils literal notranslate"><span class="pre">dict</span></code>.</p></li>
<li><p>If the data type documented in the schema is
<a class="reference external" href="https://v2.developer.pagerduty.com/docs/types#array">array</a>, then the
corresponding type in Python will be <code class="docutils literal notranslate"><span class="pre">list</span></code>.</p></li>
</ul>
</li>
<li><p>Everything is automatically JSON-encoded and decoded, using it as follows:</p>
<ul>
<li><p>To send a JSON request body, pass a <code class="docutils literal notranslate"><span class="pre">dict</span></code> object (or <code class="docutils literal notranslate"><span class="pre">list</span></code>, where
applicable) in the <code class="docutils literal notranslate"><span class="pre">json</span></code> keyword argument.</p></li>
<li><p>To get the response body as a <code class="docutils literal notranslate"><span class="pre">dict</span></code> (or <code class="docutils literal notranslate"><span class="pre">list</span></code>, if applicable), call
the <a class="reference external" href="https://2.python-requests.org/en/master/api/#requests.Response.json">json</a>
method of the response object.</p></li>
<li><p>If using the <code class="docutils literal notranslate"><span class="pre">r{VERB}</span></code> methods, i.e.  <code class="docutils literal notranslate"><span class="pre">rget</span></code>, the return value will be
the <code class="docutils literal notranslate"><span class="pre">dict</span></code>/<code class="docutils literal notranslate"><span class="pre">list</span></code> object decoded from the <a class="reference external" href="https://v2.developer.pagerduty.com/docs/wrapped-entities">wrapped entity</a>  and there is
no need to call <code class="docutils literal notranslate"><span class="pre">response.json()</span></code>.</p></li>
<li><p>Similarly, the <code class="docutils literal notranslate"><span class="pre">j{VERB}</span></code> methods, i.e.  <code class="docutils literal notranslate"><span class="pre">jget</span></code>, return the object
decoded from the JSON string in the response body (but without attempting
to unwrap any wrapped entities it may contain).</p></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="using-special-features-of-requests">
<h4>Using Special Features of Requests<a class="headerlink" href="#using-special-features-of-requests" title="Permalink to this headline">¶</a></h4>
<p>Keyword arguments to the HTTP methods get passed through to the similarly-
named functions in <a class="reference external" href="https://2.python-requests.org/en/master/api/#request-sessions">requests.Session</a>, so for additional options, please refer
to the documentation provided by the Requests project.</p>
</div>
</div>
<div class="section" id="data-access-abstraction">
<h3>Data Access Abstraction<a class="headerlink" href="#data-access-abstraction" title="Permalink to this headline">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">APISession</span></code> class, in addition to providing a more convenient way of
making the HTTP requests to the API, provides methods that yield/return dicts
representing the PagerDuty objects with their defined schemas (see: <a class="reference external" href="https://developer.pagerduty.com/api-reference/">REST API
Reference</a>) without needing to go through enclosing them in a data envelope.</p>
<p>In other words, in the process of getting from an API call to the object
representing the desired result, all of the following are taken care of:</p>
<ol class="arabic simple">
<li><p>Validate that the response HTTP status is not an error.</p></li>
<li><p>Predict the name of the envelope property which will contain the object.</p></li>
<li><p>Validate that the result contains the predicted envelope property.</p></li>
<li><p>Access the property that is encapsulated within the response.</p></li>
</ol>
<div class="section" id="supported-endpoints">
<h4>Supported Endpoints<a class="headerlink" href="#supported-endpoints" title="Permalink to this headline">¶</a></h4>
<p><strong>Please note,</strong> not all API endpoints are supported for these convenience
functions. The general rules are that the name of the wrapped resource
property must follow from the innermost resource name for the API path in
question, and that the “nodes” in the URL path (between forward slashes) must
alternate between resource type and ID.</p>
<p>For instance, for <code class="docutils literal notranslate"><span class="pre">/escalation_policies/{id}</span></code> the name must be
<code class="docutils literal notranslate"><span class="pre">escalation_policy</span></code>, and or for <code class="docutils literal notranslate"><span class="pre">/users/{id}/notification_rules</span></code> it must be
<code class="docutils literal notranslate"><span class="pre">notification_rules</span></code>.</p>
<p>For example, with <a class="reference external" href="https://developer.pagerduty.com/api-reference/reference/REST/openapiv3.json/paths/~1users~1%7Bid%7D~1sessions/get">user sessions</a>
(one API resource/endpoint that does not follow these rules), one will need to
use the plain <code class="docutils literal notranslate"><span class="pre">get</span></code> and <code class="docutils literal notranslate"><span class="pre">post</span></code> functions, or <code class="docutils literal notranslate"><span class="pre">jget</span></code> / <code class="docutils literal notranslate"><span class="pre">jpost</span></code>, because
their URLs are formatted as <code class="docutils literal notranslate"><span class="pre">/users/{id}/sessions/{type}/{session_id}</span></code> and
the wrapped resource property name is <code class="docutils literal notranslate"><span class="pre">user_sessions</span></code> / <code class="docutils literal notranslate"><span class="pre">user_session</span></code>
rather than simply <code class="docutils literal notranslate"><span class="pre">sessions</span></code> / <code class="docutils literal notranslate"><span class="pre">session</span></code>.</p>
</div>
<div class="section" id="iteration">
<h4>Iteration<a class="headerlink" href="#iteration" title="Permalink to this headline">¶</a></h4>
<p>The method <a class="reference internal" href="#pdpyras.APISession.iter_all" title="pdpyras.APISession.iter_all"><code class="xref py py-attr docutils literal notranslate"><span class="pre">pdpyras.APISession.iter_all</span></code></a> returns an iterator that yields
all results from a resource index, automatically incrementing the <code class="docutils literal notranslate"><span class="pre">offset</span></code>
parameter to advance through each page of data.</p>
<p>Note, one can perform <a class="reference external" href="https://v2.developer.pagerduty.com/docs/filtering">filtering</a> with iteration to constrain
constrain the range of results, by passing in a dictionary object as the <code class="docutils literal notranslate"><span class="pre">params</span></code>
keyword argument. Any parameters will be automatically merged with the pagination
parameters and serialized into the final URL, so there is no need to manually
construct the URL, i.e. append <code class="docutils literal notranslate"><span class="pre">?key1=value1&amp;key2=value2</span></code>.</p>
<p><strong>Example:</strong> Find all users with “Dav” in their name/email (i.e. Dave/David) in
the PagerDuty account:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">dave</span> <span class="ow">in</span> <span class="n">session</span><span class="o">.</span><span class="n">iter_all</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;query&#39;</span><span class="p">:</span><span class="s2">&quot;Dav&quot;</span><span class="p">}):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> &lt;</span><span class="si">%s</span><span class="s2">&gt;&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">dave</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">],</span> <span class="n">dave</span><span class="p">[</span><span class="s1">&#39;email&#39;</span><span class="p">]))</span>
</pre></div>
</div>
<p>Also, note, as of version 2.2, there are the methods
<a class="reference internal" href="#pdpyras.APISession.list_all" title="pdpyras.APISession.list_all"><code class="xref py py-attr docutils literal notranslate"><span class="pre">pdpyras.APISession.list_all</span></code></a> and <a class="reference internal" href="#pdpyras.APISession.dict_all" title="pdpyras.APISession.dict_all"><code class="xref py py-attr docutils literal notranslate"><span class="pre">pdpyras.APISession.dict_all</span></code></a>
which return a list or dictionary of all results, respectively.</p>
<p><strong>Example:</strong> Get a dictionary of all users, keyed by email, and use it to find
the ID of the user whose email is <code class="docutils literal notranslate"><span class="pre">bob&#64;example.com</span></code></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">users</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">dict_all</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">,</span> <span class="n">by</span><span class="o">=</span><span class="s1">&#39;email&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">users</span><span class="p">[</span><span class="s1">&#39;bob@example.com&#39;</span><span class="p">][</span><span class="s1">&#39;id&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="section" id="disclaimers-regarding-iteration">
<h4>Disclaimers Regarding Iteration<a class="headerlink" href="#disclaimers-regarding-iteration" title="Permalink to this headline">¶</a></h4>
<p><strong>Regarding Performance:</strong></p>
<p>Because HTTP requests are made synchronously and not in parallel threads, the
data will be retrieved one page at a time and the functions <code class="docutils literal notranslate"><span class="pre">list_all</span></code> and
<code class="docutils literal notranslate"><span class="pre">dict_all</span></code> will not return until after the HTTP response from the final API
call is received. Simply put, the functions will take longer to return if the
total number of results is higher.</p>
<p><strong>On Updating and Deleting Records:</strong></p>
<p>If performing page-wise operations, i.e. making changes immediately after
fetching each page of results, rather than pre-fetching all objects and then
operating on them, one must be cautious not to perform any changes to the
results that would affect the set over which iteration is taking place.</p>
<p>To elaborate, this happens whenever a resource object is deleted, or it is
updated in such a way that the filter parameters in <code class="docutils literal notranslate"><span class="pre">iter_all</span></code> no longer
apply to it. This is because indexes’ contents update in real time. Thus,
should any objects be removed from the set (the objects included in the
iteration), then the offset when accessing the next page of results will still
be incremented, whereas the position of the first object in the next page will
shift to a lower rank in the overall list of objects.</p>
<p>In other words: let’s say that one is reading and then tearing pages from a
notebook. If the algorithm is “go through 100 pages, do things with the pages,
then repeat starting with the 101st page, then with the 201st, etc” but one
tears out pages immediately after going through them, then what was originally
the 101st page before starting will shift to become the first page after going
through the first hundred pages. Thus, when going to the 101st page after
finishing tearing out the first hundred pages, the second hundred pages will be
skipped over, and similarly for pages 401-500, 601-700 and so on.</p>
<p>Also, note, a similar effect would occur if creating objects during iteration.</p>
<p>As of version 3, this issue is still applicable. To avoid it, do not use
<code class="docutils literal notranslate"><span class="pre">iter_all</span></code>, but use <code class="docutils literal notranslate"><span class="pre">list_all</span></code> or <code class="docutils literal notranslate"><span class="pre">dict_all</span></code> to pre-fetch the set of
records to be operated on, and then iterate over the results. This still does
not constitute a completely bulletproof safeguard against set changes caused by
insert/update/delete operations carried out by other simultaneous processes
(i.e. a user renaming a service through the web UI).</p>
</div>
<div class="section" id="reading">
<h4>Reading<a class="headerlink" href="#reading" title="Permalink to this headline">¶</a></h4>
<p>The method <a class="reference internal" href="#pdpyras.APISession.rget" title="pdpyras.APISession.rget"><code class="xref py py-attr docutils literal notranslate"><span class="pre">pdpyras.APISession.rget</span></code></a> gets a resource, returning the object
within the resource name envelope after JSON-decoding the response body. In
other words, if retrieving an individual user (for instance), where one would
have to JSON-decode and then access the <code class="docutils literal notranslate"><span class="pre">user</span></code> key in the resulting
dictionary object, that object itself is directly returned.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">rget</span></code> method can be called with as little as one argument: the URL (or
URL path) to request. Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">service</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">rget</span><span class="p">(</span><span class="s1">&#39;/services/PZYX321&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Service PZYX321&#39;s name: &quot;</span><span class="o">+</span><span class="n">service</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">])</span>
</pre></div>
</div>
<p>One can also use it on a <a class="reference external" href="https://v2.developer.pagerduty.com/docs/endpoints#resources-index">resource index</a>, although if the goal is to get all
results rather than a specific page, <a class="reference internal" href="#pdpyras.APISession.iter_all" title="pdpyras.APISession.iter_all"><code class="xref py py-class docutils literal notranslate"><span class="pre">pdpyras.APISession.iter_all</span></code></a> is
recommended for this purpose, as it will automatically iterate through all
pages of results, rather than just the first. When using <code class="docutils literal notranslate"><span class="pre">rget</span></code> in this way,
the return value will be a list of dicts instead of a dict.</p>
<p>The method also accepts other keyword arguments, which it will pass along to
<code class="docutils literal notranslate"><span class="pre">reqeusts.Session.get</span></code>, i.e. if requesting an index, <code class="docutils literal notranslate"><span class="pre">params</span></code> can be used
to set a filter:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">first_100_daves</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">rget</span><span class="p">(</span>
    <span class="s1">&#39;/users&#39;</span><span class="p">,</span>
    <span class="n">params</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;query&#39;</span><span class="p">:</span><span class="s2">&quot;Dave&quot;</span><span class="p">,</span><span class="s1">&#39;limit&#39;</span><span class="p">:</span><span class="mi">100</span><span class="p">}</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="creating-and-updating">
<h4>Creating and Updating<a class="headerlink" href="#creating-and-updating" title="Permalink to this headline">¶</a></h4>
<p>Just as <code class="docutils literal notranslate"><span class="pre">rget</span></code> eliminates the need to JSON-decode and then pull the data out
of the envelope in the response schema, <a class="reference internal" href="#pdpyras.APISession.rpost" title="pdpyras.APISession.rpost"><code class="xref py py-attr docutils literal notranslate"><span class="pre">pdpyras.APISession.rpost</span></code></a> and
<a class="reference internal" href="#pdpyras.APISession.rput" title="pdpyras.APISession.rput"><code class="xref py py-attr docutils literal notranslate"><span class="pre">pdpyras.APISession.rput</span></code></a> return the data in the envelope property.
Furthermore, they eliminate the need to enclose the dictionary object
representing the data to be transmitted in an envelope, and just like <code class="docutils literal notranslate"><span class="pre">rget</span></code>,
they accept at an absolute minimum one positional argument (the URL), and all
keyword arguments are passed through to the underlying request method function.</p>
<p>For instance, instead of having to set the keyword argument <code class="docutils literal notranslate"><span class="pre">json</span> <span class="pre">=</span> <span class="pre">{&quot;user&quot;:</span>
<span class="pre">{...}}</span></code> to <code class="docutils literal notranslate"><span class="pre">put</span></code>, one can pass <code class="docutils literal notranslate"><span class="pre">json</span> <span class="pre">=</span> <span class="pre">{...}</span></code> to <code class="docutils literal notranslate"><span class="pre">rput</span></code>, to update a
user. The following function takes a PagerDuty user ID and gives the
user the admin role and prints a message when done:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">promote_to_admin</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">uid</span><span class="p">):</span>
    <span class="n">user</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">rput</span><span class="p">(</span>
        <span class="s1">&#39;/users/&#39;</span><span class="o">+</span><span class="n">uid</span><span class="p">,</span>
        <span class="n">json</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;role&#39;</span><span class="p">:</span><span class="s1">&#39;admin&#39;</span><span class="p">}</span>
    <span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> now has admin superpowers&quot;</span><span class="o">%</span><span class="n">user</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="section" id="idempotent-resource-creation">
<h4>Idempotent Resource Creation<a class="headerlink" href="#idempotent-resource-creation" title="Permalink to this headline">¶</a></h4>
<p>Beyond just creating a resource, <a class="reference internal" href="#pdpyras.APISession.persist" title="pdpyras.APISession.persist"><code class="xref py py-attr docutils literal notranslate"><span class="pre">pdpyras.APISession.persist</span></code></a> can be used
to perform a check for a preexisting object before creating it; it returns the
persisted resource, whether or not the object already existed.</p>
<p>For instance, the following will create a user having email address
<code class="docutils literal notranslate"><span class="pre">user&#64;organization.com</span></code> if one does not already exist, and print that user’s
name:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">user</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">persist</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">,</span> <span class="s1">&#39;email&#39;</span><span class="p">,</span> <span class="p">{</span>
    <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;User McUserson&quot;</span><span class="p">,</span>
    <span class="s2">&quot;email&quot;</span><span class="p">:</span> <span class="s2">&quot;user@organization.com&quot;</span><span class="p">,</span>
    <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;user&quot;</span>
<span class="p">})</span>
<span class="nb">print</span><span class="p">(</span><span class="n">user</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="section" id="deleting">
<h4>Deleting<a class="headerlink" href="#deleting" title="Permalink to this headline">¶</a></h4>
<p>The <code class="docutils literal notranslate"><span class="pre">rdelete</span></code> method has no return value, but otherwise behaves in exactly
the same way as the other request methods with <code class="docutils literal notranslate"><span class="pre">r</span></code> prepended to their name.
Like the other <code class="docutils literal notranslate"><span class="pre">r*</span></code> methods, it will raise <a class="reference internal" href="#pdpyras.PDClientError" title="pdpyras.PDClientError"><code class="xref py py-class docutils literal notranslate"><span class="pre">pdpyras.PDClientError</span></code></a> if
the API responds with a non-success HTTP status.</p>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">session</span><span class="o">.</span><span class="n">rdelete</span><span class="p">(</span><span class="s2">&quot;/services/PI86NOW&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Service deleted.&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="managing-a-k-a-multi-updating">
<h4>Managing, a.k.a. Multi-Updating<a class="headerlink" href="#managing-a-k-a-multi-updating" title="Permalink to this headline">¶</a></h4>
<p>Introduced in version 2.1 is support for automatic data envelope functionality
in multi-update actions.</p>
<p>As of this writing, multi-update is limited to the following actions:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://developer.pagerduty.com/api-reference/reference/REST/openapiv3.json/paths/~1incidents/put">PUT /incidents</a></p></li>
<li><p><a class="reference external" href="https://developer.pagerduty.com/api-reference/reference/REST/openapiv3.json/paths/~1incidents~1%7Bid%7D~1alerts/put">PUT /incidents/{id}/alerts</a></p></li>
<li><p><strong>PUT /priorities</strong> (not yet published, as of 2018-11-28)</p></li>
</ul>
<p><strong>Please note:</strong> as of yet, merging incidents is not supported by <code class="docutils literal notranslate"><span class="pre">rput</span></code>.
For this and other unsupported endpoints, you will need to call <code class="docutils literal notranslate"><span class="pre">put</span></code> directly,
or <code class="docutils literal notranslate"><span class="pre">jput</span></code> to get the response body as a dictionary object.</p>
<p>To use, simply pass in a list of objects or references (dictionaries having a
structure according to the API schema reference for that object type) to the
<code class="docutils literal notranslate"><span class="pre">json</span></code> keyword argument of <a class="reference internal" href="#pdpyras.APISession.rput" title="pdpyras.APISession.rput"><code class="xref py py-attr docutils literal notranslate"><span class="pre">pdpyras.APISession.rput</span></code></a>, and the final
payload will be an object with one property named after the resource,
containing that list.</p>
<p>For instance, to resolve two incidents with IDs <code class="docutils literal notranslate"><span class="pre">PABC123</span></code> and <code class="docutils literal notranslate"><span class="pre">PDEF456</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">session</span><span class="o">.</span><span class="n">rput</span><span class="p">(</span>
    <span class="s2">&quot;incidents&quot;</span><span class="p">,</span>
    <span class="n">json</span><span class="o">=</span><span class="p">[{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span><span class="s1">&#39;PABC123&#39;</span><span class="p">,</span><span class="s1">&#39;type&#39;</span><span class="p">:</span><span class="s1">&#39;incident_reference&#39;</span><span class="p">,</span> <span class="s1">&#39;status&#39;</span><span class="p">:</span><span class="s1">&#39;resolved&#39;</span><span class="p">},</span>
          <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span><span class="s1">&#39;PDEF456&#39;</span><span class="p">,</span><span class="s1">&#39;type&#39;</span><span class="p">:</span><span class="s1">&#39;incident_reference&#39;</span><span class="p">,</span> <span class="s1">&#39;status&#39;</span><span class="p">:</span><span class="s1">&#39;resolved&#39;</span><span class="p">}]</span>
<span class="p">)</span>
</pre></div>
</div>
<p>In this way, a single API request can more efficiently perform multiple update
actions.</p>
<p>It is important to note, however, that certain actions such as updating
incidents require the <code class="docutils literal notranslate"><span class="pre">From</span></code> header, which should be the login email address
of a valid PagerDuty user. To set this, pass it through using the <code class="docutils literal notranslate"><span class="pre">headers</span></code>
keyword argument, or set the <a class="reference internal" href="#pdpyras.APISession.default_from" title="pdpyras.APISession.default_from"><code class="xref py py-attr docutils literal notranslate"><span class="pre">pdpyras.APISession.default_from</span></code></a> property.</p>
</div>
<div class="section" id="using-resources-in-place-of-urls">
<h4>Using Resources in Place of URLs<a class="headerlink" href="#using-resources-in-place-of-urls" title="Permalink to this headline">¶</a></h4>
<p>As of version 4.1, one may send the dictionary representation of a resource to
any of the <code class="docutils literal notranslate"><span class="pre">r*</span></code> methods, with the exception of <code class="docutils literal notranslate"><span class="pre">rpost</span></code>, in place of a URL
or path. The dictionary must contain a <code class="docutils literal notranslate"><span class="pre">self</span></code> item that is the URL of the
resource.</p>
<p>This eliminates the need to construct the resource’s path/URL, or to keep a
temporary variable with the URL needed for accessing the object.</p>
<p>For instance, to reload a service object previously fetched from the API, i.e.
to ensure one has the latest data for that resource:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">user</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">rget</span><span class="p">(</span><span class="s1">&#39;users/PSOMEUSR&#39;</span><span class="p">)</span>

<span class="c1"># Do things that take a lot of time during which the user might change</span>
<span class="c1"># ...</span>

<span class="c1"># Reload the user:</span>
<span class="n">user</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">rget</span><span class="p">(</span><span class="n">user</span><span class="p">)</span>
<span class="c1"># as opposed to:</span>
<span class="c1"># user = session.rget(&#39;users/PSOMEUSR&#39;)</span>
</pre></div>
</div>
<p>Another example: to delete a service:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">session</span><span class="o">.</span><span class="n">rdelete</span><span class="p">(</span><span class="n">service</span><span class="p">)</span>
<span class="c1"># as opposed to:</span>
<span class="c1"># session.rdelete(service[&#39;self&#39;])</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="error-handling">
<h3>Error Handling<a class="headerlink" href="#error-handling" title="Permalink to this headline">¶</a></h3>
<p>What happens when, for any of the <code class="docutils literal notranslate"><span class="pre">r*</span></code> methods, the API responds with a
non-success HTTP status? Obviously in this case, they cannot return the
JSON-decoded response, because the response would not be the sought-after data
but a different schema altogether (see: <a class="reference external" href="https://v2.developer.pagerduty.com/docs/errors">Errors</a>), and this would put the onus
on the end user to distinguish between success and error based on the structure
of the returned dictionary object (yuck).</p>
<p>Instead, when this happens, a <a class="reference internal" href="#pdpyras.PDClientError" title="pdpyras.PDClientError"><code class="xref py py-class docutils literal notranslate"><span class="pre">pdpyras.PDClientError</span></code></a> exception is
raised. The advantage of this design lies in how the methods can always be
expected to return the same sort of data, and if they can’t, the program flow
that depends on getting this specific structure of data is appropriately
interrupted. Moreover, because (as of version 2) this exception class will have
the <a class="reference external" href="https://2.python-requests.org/en/master/api/#requests.Response">requests.Response</a> object as its <code class="docutils literal notranslate"><span class="pre">response</span></code> property (whenever the
exception pertains to a HTTP error), the end user can define specialized error
handling logic in which the REST API response data (i.e. headers, code and body)
are directly available.</p>
<p>For instance, the following code prints “User not found” in the event of a 404,
raises the underlying exception in the event of an incorrect API access token (401
Unauthorized) or non-transient network error, prints out the user’s email if
the user exists, and does nothing otherwise:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">try</span><span class="p">:</span>
    <span class="n">user</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">rget</span><span class="p">(</span><span class="s2">&quot;/users/PJKL678&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">user</span><span class="p">[</span><span class="s1">&#39;email&#39;</span><span class="p">])</span>
<span class="k">except</span> <span class="n">PDClientError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">response</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">404</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;User not found&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">e</span><span class="o">.</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">401</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">e</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">e</span>
</pre></div>
</div>
<p>Just make sure to import <cite>PDClientError</cite> or reference it throught he namespace, i.e.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pdpyras</span> <span class="kn">import</span> <span class="n">APISession</span><span class="p">,</span> <span class="n">PDClientError</span>

<span class="k">except</span> <span class="n">PDClientError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</pre></div>
</div>
<p>Or:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pdpyras</span>

<span class="o">...</span>

<span class="k">except</span> <span class="n">pdpyras</span><span class="o">.</span><span class="n">PDClientError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<span class="o">...</span>
</pre></div>
</div>
</div>
<div class="section" id="http-retry-logic">
<h3>HTTP Retry Logic<a class="headerlink" href="#http-retry-logic" title="Permalink to this headline">¶</a></h3>
<p>By default, after receiving a response, <a class="reference internal" href="#pdpyras.PDSession.request" title="pdpyras.PDSession.request"><code class="xref py py-attr docutils literal notranslate"><span class="pre">pdpyras.PDSession.request</span></code></a> will
return the <a class="reference external" href="https://2.python-requests.org/en/master/api/#requests.Response">requests.Response</a> object unless its status is <code class="docutils literal notranslate"><span class="pre">429</span></code> (rate
limiting), in which case it will retry until it gets a status other than <code class="docutils literal notranslate"><span class="pre">429</span></code>.</p>
<p>The property <a class="reference internal" href="#pdpyras.PDSession.retry" title="pdpyras.PDSession.retry"><code class="xref py py-attr docutils literal notranslate"><span class="pre">pdpyras.PDSession.retry</span></code></a> allows customization in this
regard, so that the client can be made to retry on other statuses (i.e.
502/400), up to a set number of times. The total number of HTTP error responses
that the client will tolerate before returning the response object is defined
in <a class="reference internal" href="#pdpyras.PDSession.max_http_attempts" title="pdpyras.PDSession.max_http_attempts"><code class="xref py py-attr docutils literal notranslate"><span class="pre">pdpyras.PDSession.max_http_attempts</span></code></a>, and this will supersede the
maximum number of retries defined in
<a class="reference internal" href="#pdpyras.PDSession.retry" title="pdpyras.PDSession.retry"><code class="xref py py-attr docutils literal notranslate"><span class="pre">pdpyras.PDSession.retry</span></code></a>.</p>
<p><strong>Example:</strong></p>
<p>The following will take about 30 seconds plus API request time
(carrying out four attempts, with 2, 4, 8 and 16 second pauses between them),
before finally returning with the status 404 <a class="reference external" href="https://2.python-requests.org/en/master/api/#requests.Response">requests.Response</a> object:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">session</span><span class="o">.</span><span class="n">retry</span><span class="p">[</span><span class="mi">404</span><span class="p">]</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">session</span><span class="o">.</span><span class="n">max_http_attempts</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">session</span><span class="o">.</span><span class="n">sleep_timer</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">session</span><span class="o">.</span><span class="n">sleep_timer_base</span> <span class="o">=</span> <span class="mi">2</span>
<span class="c1"># isinstance(session, pdpyras.APISession)</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;/users/PNOEXST&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>Default Behavior:</strong></p>
<p>Note that without specifying any retry behavior for status 429 (rate limiting),
it will retry indefinitely. This is a sane approach; if it is ever responding
with 429, this means that the REST API is receiving (for the given REST API
key) too many requests, and the issue should by nature be transient.</p>
<p>Similarly, there is hard-coded default behavior for status 401 (unauthorized):
immediately raise <a class="reference internal" href="#pdpyras.PDClientError" title="pdpyras.PDClientError"><code class="xref py py-class docutils literal notranslate"><span class="pre">pdpyras.PDClientError</span></code></a> (as this can be considered in
all cases a completely non-transient error).</p>
<p>It is still possible to override these behaviors using
<a class="reference internal" href="#pdpyras.PDSession.retry" title="pdpyras.PDSession.retry"><code class="xref py py-attr docutils literal notranslate"><span class="pre">pdpyras.PDSession.retry</span></code></a>, but it is not recommended.</p>
</div>
<div class="section" id="events-api-usage">
<h3>Events API Usage<a class="headerlink" href="#events-api-usage" title="Permalink to this headline">¶</a></h3>
<p>As an added bonus, <code class="docutils literal notranslate"><span class="pre">pdpyras</span></code> provides an additional Session class for submitting
alert data to the Events API and triggering incidents asynchronously:
<a class="reference internal" href="#pdpyras.EventsAPISession" title="pdpyras.EventsAPISession"><code class="xref py py-class docutils literal notranslate"><span class="pre">pdpyras.EventsAPISession</span></code></a>. It has most of the same features as
<a class="reference internal" href="#pdpyras.APISession" title="pdpyras.APISession"><code class="xref py py-class docutils literal notranslate"><span class="pre">pdpyras.APISession</span></code></a>:</p>
<ul class="simple">
<li><p>Connection persistence</p></li>
<li><p>Automatic cooldown and retry in the event of rate limiting or a transient network error</p></li>
<li><p>Setting all required headers</p></li>
<li><p>Configurable HTTP retry logic</p></li>
</ul>
<p>To transmit alerts and perform actions through the events API, one would use:</p>
<ul class="simple">
<li><p><a class="reference internal" href="#pdpyras.EventsAPISession.trigger" title="pdpyras.EventsAPISession.trigger"><code class="xref py py-attr docutils literal notranslate"><span class="pre">pdpyras.EventsAPISession.trigger</span></code></a></p></li>
<li><p><a class="reference internal" href="#pdpyras.EventsAPISession.acknowledge" title="pdpyras.EventsAPISession.acknowledge"><code class="xref py py-attr docutils literal notranslate"><span class="pre">pdpyras.EventsAPISession.acknowledge</span></code></a></p></li>
<li><p><a class="reference internal" href="#pdpyras.EventsAPISession.resolve" title="pdpyras.EventsAPISession.resolve"><code class="xref py py-attr docutils literal notranslate"><span class="pre">pdpyras.EventsAPISession.resolve</span></code></a></p></li>
</ul>
<p>To instantiate a session object, pass the constructor the routing key:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pdpyras</span>
<span class="n">routing_key</span> <span class="o">=</span> <span class="s1">&#39;0123456789abcdef0123456789abcdef&#39;</span>
<span class="n">session</span> <span class="o">=</span> <span class="n">pdpyras</span><span class="o">.</span><span class="n">EventsAPISession</span><span class="p">(</span><span class="n">routing_key</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>Example 1:</strong> Trigger an event and use the PagerDuty-supplied deduplication key to resolve it later:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">dedup_key</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">trigger</span><span class="p">(</span><span class="s2">&quot;Server is on fire&quot;</span><span class="p">,</span> <span class="s1">&#39;dusty.old.server.net&#39;</span><span class="p">)</span>
<span class="c1"># ...</span>
<span class="n">session</span><span class="o">.</span><span class="n">resolve</span><span class="p">(</span><span class="n">dedup_key</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>Example 2:</strong> Trigger an event, specifying a dedup key, and use it to later acknowledge the incident</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">session</span><span class="o">.</span><span class="n">trigger</span><span class="p">(</span><span class="s2">&quot;Server is on fire&quot;</span><span class="p">,</span> <span class="s1">&#39;dusty.old.server.net&#39;</span><span class="p">,</span>
    <span class="n">dedup_key</span><span class="o">=</span><span class="s1">&#39;abc123&#39;</span><span class="p">)</span>
<span class="c1"># ...</span>
<span class="n">session</span><span class="o">.</span><span class="n">acknowledge</span><span class="p">(</span><span class="s1">&#39;abc123&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="contributing">
<h2>Contributing<a class="headerlink" href="#contributing" title="Permalink to this headline">¶</a></h2>
<p>Bug reports and pull requests to fix issues are always welcome.</p>
<p>If adding features, or making changes, it is recommended to update or add tests
and assertions to the appropriate test case class in <code class="docutils literal notranslate"><span class="pre">test_pdpyras.py</span></code> to ensure
code coverage. If the change(s) fix a bug, please add assertions that reproduce
the bug along with code changes themselves, and include the GitHub issue number
in the commit message.</p>
<p><em>Code author: Demitri Morgan &lt;<a class="reference external" href="mailto:demitri&#37;&#52;&#48;pagerduty&#46;com">demitri<span>&#64;</span>pagerduty<span>&#46;</span>com</a>&gt;</em></p>
</div>
<div class="section" id="developer-interface">
<h2>Developer Interface<a class="headerlink" href="#developer-interface" title="Permalink to this headline">¶</a></h2>
<div class="section" id="generic-api-client">
<h3>Generic API Client<a class="headerlink" href="#generic-api-client" title="Permalink to this headline">¶</a></h3>
<p>This base class implements features common to both <a class="reference internal" href="#pdpyras.APISession" title="pdpyras.APISession"><code class="xref py py-class docutils literal notranslate"><span class="pre">pdpyras.APISession</span></code></a>
and <a class="reference internal" href="#pdpyras.EventsAPISession" title="pdpyras.EventsAPISession"><code class="xref py py-class docutils literal notranslate"><span class="pre">pdpyras.EventsAPISession</span></code></a>.</p>
<dl class="py class">
<dt id="pdpyras.PDSession">
<em class="property">class </em><code class="sig-prename descclassname">pdpyras.</code><code class="sig-name descname">PDSession</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">api_key</span></em>, <em class="sig-param"><span class="n">name</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="headerlink" href="#pdpyras.PDSession" title="Permalink to this definition">¶</a></dt>
<dd><p>Base class for making HTTP requests to PagerDuty APIs.</p>
<p>Instances of this class are essentially the same as <a class="reference external" href="https://2.python-requests.org/en/master/api/#request-sessions">requests.Session</a>
objects, but with a few modifications:</p>
<ul class="simple">
<li><p>The client will reattempt the request with configurable, auto-increasing
cooldown/retry intervals if encountering a network error or rate limit</p></li>
<li><p>When making requests, headers specified ad-hoc in calls to HTTP verb
functions will not replace, but will be merged with, default headers.</p></li>
<li><p>The request URL, if it doesn’t already start with the REST API base URL,
will be prepended with the default REST API base URL.</p></li>
<li><p>It will only perform requests with methods as given in the
<code class="xref py py-attr docutils literal notranslate"><span class="pre">permitted_methods</span></code> list, and will raise <a class="reference internal" href="#pdpyras.PDClientError" title="pdpyras.PDClientError"><code class="xref py py-class docutils literal notranslate"><span class="pre">PDClientError</span></code></a> for
any other HTTP methods.</p></li>
</ul>
<dl class="py method">
<dt id="pdpyras.PDSession.after_set_api_key">
<code class="sig-name descname">after_set_api_key</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#pdpyras.PDSession.after_set_api_key" title="Permalink to this definition">¶</a></dt>
<dd><p>Setter hook for setting or updating the API key.</p>
<p>Child classes should implement this to perform additional steps.</p>
</dd></dl>

<dl class="py method">
<dt id="pdpyras.PDSession.api_key">
<em class="property">property </em><code class="sig-name descname">api_key</code><a class="headerlink" href="#pdpyras.PDSession.api_key" title="Permalink to this definition">¶</a></dt>
<dd><p>API Key property getter.</p>
<p>Returns the _api_key attribute’s value.</p>
</dd></dl>

<dl class="py method">
<dt id="pdpyras.PDSession.api_key_access">
<em class="property">property </em><code class="sig-name descname">api_key_access</code><a class="headerlink" href="#pdpyras.PDSession.api_key_access" title="Permalink to this definition">¶</a></dt>
<dd><p>Memoized API key access type getter.</p>
<p>Will be “user” if the API key is a user-level token (all users should
have permission to create an API key with the same permissions as they
have in the PagerDuty web UI).</p>
<p>If the API key in use is an account-level API token (as only a global
administrator user can create), this property will be “account”.</p>
</dd></dl>

<dl class="py method">
<dt id="pdpyras.PDSession.auth_header">
<em class="property">property </em><code class="sig-name descname">auth_header</code><a class="headerlink" href="#pdpyras.PDSession.auth_header" title="Permalink to this definition">¶</a></dt>
<dd><p>Generates the header with the API credential used for authentication.</p>
</dd></dl>

<dl class="py attribute">
<dt id="pdpyras.PDSession.log">
<code class="sig-name descname">log</code><em class="property"> = None</em><a class="headerlink" href="#pdpyras.PDSession.log" title="Permalink to this definition">¶</a></dt>
<dd><p>A <code class="docutils literal notranslate"><span class="pre">logging.Logger</span></code> object for printing messages.</p>
</dd></dl>

<dl class="py attribute">
<dt id="pdpyras.PDSession.max_http_attempts">
<code class="sig-name descname">max_http_attempts</code><em class="property"> = 10</em><a class="headerlink" href="#pdpyras.PDSession.max_http_attempts" title="Permalink to this definition">¶</a></dt>
<dd><p>The number of times that the client will retry after error statuses, for any
that are defined greater than zero in <a class="reference internal" href="#pdpyras.PDSession.retry" title="pdpyras.PDSession.retry"><code class="xref py py-attr docutils literal notranslate"><span class="pre">retry</span></code></a>.</p>
</dd></dl>

<dl class="py attribute">
<dt id="pdpyras.PDSession.max_network_attempts">
<code class="sig-name descname">max_network_attempts</code><em class="property"> = 3</em><a class="headerlink" href="#pdpyras.PDSession.max_network_attempts" title="Permalink to this definition">¶</a></dt>
<dd><p>The number of times that connecting to the API will be attempted before
treating the failure as non-transient; a <a class="reference internal" href="#pdpyras.PDClientError" title="pdpyras.PDClientError"><code class="xref py py-class docutils literal notranslate"><span class="pre">PDClientError</span></code></a> exception
will be raised if this happens.</p>
</dd></dl>

<dl class="py attribute">
<dt id="pdpyras.PDSession.parent">
<code class="sig-name descname">parent</code><em class="property"> = None</em><a class="headerlink" href="#pdpyras.PDSession.parent" title="Permalink to this definition">¶</a></dt>
<dd><p>The <code class="docutils literal notranslate"><span class="pre">super</span></code> object (<a class="reference external" href="https://2.python-requests.org/en/master/api/#request-sessions">requests.Session</a>)</p>
</dd></dl>

<dl class="py method">
<dt id="pdpyras.PDSession.postprocess">
<code class="sig-name descname">postprocess</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">response</span></em><span class="sig-paren">)</span><a class="headerlink" href="#pdpyras.PDSession.postprocess" title="Permalink to this definition">¶</a></dt>
<dd><p>Perform supplemental actions immediately after receiving a response.</p>
</dd></dl>

<dl class="py method">
<dt id="pdpyras.PDSession.prepare_headers">
<code class="sig-name descname">prepare_headers</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">method</span></em><span class="sig-paren">)</span><a class="headerlink" href="#pdpyras.PDSession.prepare_headers" title="Permalink to this definition">¶</a></dt>
<dd><p>Append special additional per-request headers.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>method</strong> – The HTTP method, in upper case.</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt id="pdpyras.PDSession.raise_if_http_error">
<code class="sig-name descname">raise_if_http_error</code><em class="property"> = True</em><a class="headerlink" href="#pdpyras.PDSession.raise_if_http_error" title="Permalink to this definition">¶</a></dt>
<dd><p>Raise an exception upon receiving an error response from the server.</p>
<p>This affects iteration (in the REST API) as well as the generic request
method itself.</p>
<p>In the general case: if set to True, then upon receiving a non-transient
HTTP error (from too many retries), an exception will be raised. Otherwise,
the response object will be returned.</p>
<p>In iteration: if set to true, an exception will be raised in
<code class="xref py py-attr docutils literal notranslate"><span class="pre">iter_all</span></code> if a HTTP error is encountered. This is the default
behavior in versions &gt;= 2.1.0.  If False, the behavior is to halt iteration
upon receiving a HTTP error.</p>
</dd></dl>

<dl class="py method">
<dt id="pdpyras.PDSession.request">
<code class="sig-name descname">request</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">method</span></em>, <em class="sig-param"><span class="n">url</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">kwargs</span></em><span class="sig-paren">)</span><a class="headerlink" href="#pdpyras.PDSession.request" title="Permalink to this definition">¶</a></dt>
<dd><p>Make a generic PagerDuty API request.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>method</strong> (<em>str</em>) – The request method to use. Case-insensitive. May be one of get, put,
post or delete.</p></li>
<li><p><strong>url</strong> (<em>str</em>) – The path/URL to request. If it does not start with the base URL, the
base URL will be prepended.</p></li>
<li><p><strong>**kwargs</strong> – <p>Additional keyword arguments to pass to <a class="reference external" href="https://2.python-requests.org/en/master/api/#requests.Session.request">requests.Session.request</a></p>
</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>the HTTP response object</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><a class="reference external" href="https://2.python-requests.org/en/master/api/#requests.Response">requests.Response</a></p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt id="pdpyras.PDSession.retry">
<code class="sig-name descname">retry</code><em class="property"> = {}</em><a class="headerlink" href="#pdpyras.PDSession.retry" title="Permalink to this definition">¶</a></dt>
<dd><p>A dict defining the retry behavior for each HTTP response status code.</p>
<p>Note, any value set for this class variable will not be reflected in
instances and so it must be set separately for each instance.</p>
<p>Each key in this dictionary represents a HTTP response code. The behavior is
specified by the value at each key as follows:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">-1</span></code> to retry infinitely</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">0</span></code> to return the <a class="reference external" href="https://2.python-requests.org/en/master/api/#requests.Response">requests.Response</a> object and exit (which is the
default behavior)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">n</span></code>, where <code class="docutils literal notranslate"><span class="pre">n</span> <span class="pre">&gt;</span> <span class="pre">0</span></code>, to retry <code class="docutils literal notranslate"><span class="pre">n</span></code> times (or up
to <a class="reference internal" href="#pdpyras.PDSession.max_http_attempts" title="pdpyras.PDSession.max_http_attempts"><code class="xref py py-attr docutils literal notranslate"><span class="pre">max_http_attempts</span></code></a> total for all statuses, whichever is
encountered first), and raise a <a class="reference internal" href="#pdpyras.PDClientError" title="pdpyras.PDClientError"><code class="xref py py-class docutils literal notranslate"><span class="pre">PDClientError</span></code></a> after that many
attempts. For each successive attempt, the wait time will increase by a
factor of <a class="reference internal" href="#pdpyras.PDSession.sleep_timer_base" title="pdpyras.PDSession.sleep_timer_base"><code class="xref py py-attr docutils literal notranslate"><span class="pre">sleep_timer_base</span></code></a>.</p></li>
</ul>
<p>The default behavior is to retry infinitely on a 429, and return the
response in any other case (assuming a HTTP response was received from the
server).</p>
</dd></dl>

<dl class="py method">
<dt id="pdpyras.PDSession.set_api_key">
<code class="sig-name descname">set_api_key</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">api_key</span></em><span class="sig-paren">)</span><a class="headerlink" href="#pdpyras.PDSession.set_api_key" title="Permalink to this definition">¶</a></dt>
<dd><p>(Deprecated) set the API key/token.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>api_key</strong> (<em>str</em>) – The API key to use</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt id="pdpyras.PDSession.sleep_timer">
<code class="sig-name descname">sleep_timer</code><em class="property"> = 1.5</em><a class="headerlink" href="#pdpyras.PDSession.sleep_timer" title="Permalink to this definition">¶</a></dt>
<dd><p>Default initial cooldown time factor for rate limiting and network errors.</p>
<p>Each time that the request makes a followup request, there will be a delay
in seconds equal to this number times <a class="reference internal" href="#pdpyras.PDSession.sleep_timer_base" title="pdpyras.PDSession.sleep_timer_base"><code class="xref py py-attr docutils literal notranslate"><span class="pre">sleep_timer_base</span></code></a> to the power
of how many attempts have already been made so far.</p>
</dd></dl>

<dl class="py attribute">
<dt id="pdpyras.PDSession.sleep_timer_base">
<code class="sig-name descname">sleep_timer_base</code><em class="property"> = 2</em><a class="headerlink" href="#pdpyras.PDSession.sleep_timer_base" title="Permalink to this definition">¶</a></dt>
<dd><p>After each retry, the time to sleep before reattempting the API connection
and request will increase by a factor of this amount.</p>
</dd></dl>

<dl class="py method">
<dt id="pdpyras.PDSession.stagger_cooldown">
<em class="property">property </em><code class="sig-name descname">stagger_cooldown</code><a class="headerlink" href="#pdpyras.PDSession.stagger_cooldown" title="Permalink to this definition">¶</a></dt>
<dd><p>Randomizing factor for wait times between retries during rate limiting.</p>
<p>If set to number greater than 0, the sleep time for rate limiting will
(for each successive sleep) be adjusted by a factor of one plus a
uniformly-distributed random number between 0 and 1 times this number,
on top of the base sleep timer <a class="reference internal" href="#pdpyras.PDSession.sleep_timer_base" title="pdpyras.PDSession.sleep_timer_base"><code class="xref py py-attr docutils literal notranslate"><span class="pre">sleep_timer_base</span></code></a>.</p>
<p>For example:</p>
<ul class="simple">
<li><p>If this is 1, and <a class="reference internal" href="#pdpyras.PDSession.sleep_timer_base" title="pdpyras.PDSession.sleep_timer_base"><code class="xref py py-attr docutils literal notranslate"><span class="pre">sleep_timer_base</span></code></a> is 2 (default), then after
each status 429 response, the sleep time will change overall by a
random factor between 2 and 4, whereas if it is zero, it will change
by a factor of 2.</p></li>
<li><p>If <a class="reference internal" href="#pdpyras.PDSession.sleep_timer_base" title="pdpyras.PDSession.sleep_timer_base"><code class="xref py py-attr docutils literal notranslate"><span class="pre">sleep_timer_base</span></code></a> is 1, then the cooldown time will be
adjusted by a random factor between one and one plus this number.</p></li>
</ul>
<p>If the number is set to zero, then this behavior is effectively
disabled, and the cooldown factor (by which the sleep time is adjusted)
will just be <a class="reference internal" href="#pdpyras.PDSession.sleep_timer_base" title="pdpyras.PDSession.sleep_timer_base"><code class="xref py py-attr docutils literal notranslate"><span class="pre">sleep_timer_base</span></code></a></p>
<p>Setting this to a nonzero number helps avoid the “thundering herd”
effect that can potentially be caused by many API clients making
simultaneous concurrent API requests and consequently waiting for the
same amount of time before retrying.  It is currently zero by default
for consistent behavior with previous versions.</p>
</dd></dl>

<dl class="py method">
<dt id="pdpyras.PDSession.trunc_key">
<em class="property">property </em><code class="sig-name descname">trunc_key</code><a class="headerlink" href="#pdpyras.PDSession.trunc_key" title="Permalink to this definition">¶</a></dt>
<dd><p>Truncated key for secure display/identification purposes.</p>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="rest-api-client">
<h3>REST API Client<a class="headerlink" href="#rest-api-client" title="Permalink to this headline">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">APISession</span></code> class inherits from <a class="reference internal" href="#pdpyras.PDSession" title="pdpyras.PDSession"><code class="xref py py-class docutils literal notranslate"><span class="pre">pdpyras.PDSession</span></code></a> and
implements features specific to usage of the REST API.</p>
<dl class="py class">
<dt id="pdpyras.APISession">
<em class="property">class </em><code class="sig-prename descclassname">pdpyras.</code><code class="sig-name descname">APISession</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">api_key</span></em>, <em class="sig-param"><span class="n">name</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">default_from</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">auth_type</span><span class="o">=</span><span class="default_value">'token'</span></em><span class="sig-paren">)</span><a class="headerlink" href="#pdpyras.APISession" title="Permalink to this definition">¶</a></dt>
<dd><p>Reusable PagerDuty REST API session objects for making API requests.</p>
<p>Includes some convenience functions as well, i.e. <a class="reference internal" href="#pdpyras.APISession.rget" title="pdpyras.APISession.rget"><code class="xref py py-attr docutils literal notranslate"><span class="pre">rget</span></code></a>, <a class="reference internal" href="#pdpyras.APISession.find" title="pdpyras.APISession.find"><code class="xref py py-attr docutils literal notranslate"><span class="pre">find</span></code></a>
and <a class="reference internal" href="#pdpyras.APISession.iter_all" title="pdpyras.APISession.iter_all"><code class="xref py py-attr docutils literal notranslate"><span class="pre">iter_all</span></code></a>, to eliminate some repetitive tasks associated with
making API calls.</p>
<p>Inherits from <a class="reference internal" href="#pdpyras.PDSession" title="pdpyras.PDSession"><code class="xref py py-class docutils literal notranslate"><span class="pre">PDSession</span></code></a>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>api_key</strong> – REST API access token to use for HTTP requests</p></li>
<li><p><strong>name</strong> (<em>str</em><em> or </em><em>None</em>) – Optional name identifier for logging. If unspecified or <code class="docutils literal notranslate"><span class="pre">None</span></code>, it
will be the last four characters of the REST API token.</p></li>
<li><p><strong>default_from</strong> (<em>str</em><em> or </em><em>None</em>) – Email address of a valid PagerDuty user to use in API requests by
default as the <code class="docutils literal notranslate"><span class="pre">From</span></code> header (see: <a class="reference external" href="https://v2.developer.pagerduty.com/docs/rest-api#http-request-headers">HTTP Request Headers</a>)</p></li>
</ul>
</dd>
<dt class="field-even">Members</dt>
<dd class="field-even"><p></p></dd>
</dl>
<dl class="py method">
<dt id="pdpyras.APISession.rdelete">
<code class="sig-name descname">rdelete</code><span class="sig-paren">(</span><em class="sig-param">self</em>, <em class="sig-param">path</em>, <em class="sig-param">\*\*kw</em><span class="sig-paren">)</span><a class="headerlink" href="#pdpyras.APISession.rdelete" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt id="pdpyras.APISession.rget">
<code class="sig-name descname">rget</code><span class="sig-paren">(</span><em class="sig-param">self</em>, <em class="sig-param">path</em>, <em class="sig-param">\*\*kw</em><span class="sig-paren">)</span><a class="headerlink" href="#pdpyras.APISession.rget" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt id="pdpyras.APISession.rpost">
<code class="sig-name descname">rpost</code><span class="sig-paren">(</span><em class="sig-param">self</em>, <em class="sig-param">path</em>, <em class="sig-param">\*\*kw</em><span class="sig-paren">)</span><a class="headerlink" href="#pdpyras.APISession.rpost" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt id="pdpyras.APISession.rput">
<code class="sig-name descname">rput</code><span class="sig-paren">(</span><em class="sig-param">self</em>, <em class="sig-param">path</em>, <em class="sig-param">\*\*kw</em><span class="sig-paren">)</span><a class="headerlink" href="#pdpyras.APISession.rput" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt id="pdpyras.APISession.after_set_api_key">
<code class="sig-name descname">after_set_api_key</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#pdpyras.APISession.after_set_api_key" title="Permalink to this definition">¶</a></dt>
<dd><p>Setter hook for setting or updating the API key.</p>
<p>Child classes should implement this to perform additional steps.</p>
</dd></dl>

<dl class="py attribute">
<dt id="pdpyras.APISession.api_call_counts">
<code class="sig-name descname">api_call_counts</code><em class="property"> = None</em><a class="headerlink" href="#pdpyras.APISession.api_call_counts" title="Permalink to this definition">¶</a></dt>
<dd><p>A dict object recording the number of API calls per endpoint</p>
</dd></dl>

<dl class="py attribute">
<dt id="pdpyras.APISession.api_time">
<code class="sig-name descname">api_time</code><em class="property"> = None</em><a class="headerlink" href="#pdpyras.APISession.api_time" title="Permalink to this definition">¶</a></dt>
<dd><p>A dict object recording the total time of API calls to each endpoint</p>
</dd></dl>

<dl class="py method">
<dt id="pdpyras.APISession.auth_header">
<em class="property">property </em><code class="sig-name descname">auth_header</code><a class="headerlink" href="#pdpyras.APISession.auth_header" title="Permalink to this definition">¶</a></dt>
<dd><p>Generates the header with the API credential used for authentication.</p>
</dd></dl>

<dl class="py method">
<dt id="pdpyras.APISession.auth_type">
<em class="property">property </em><code class="sig-name descname">auth_type</code><a class="headerlink" href="#pdpyras.APISession.auth_type" title="Permalink to this definition">¶</a></dt>
<dd><p>Defines the method of API authentication.</p>
<p>By default this is “token”; if “oauth2”, the API key will be used.</p>
</dd></dl>

<dl class="py attribute">
<dt id="pdpyras.APISession.default_from">
<code class="sig-name descname">default_from</code><em class="property"> = None</em><a class="headerlink" href="#pdpyras.APISession.default_from" title="Permalink to this definition">¶</a></dt>
<dd><p>The default value to use as the <code class="docutils literal notranslate"><span class="pre">From</span></code> request header</p>
</dd></dl>

<dl class="py attribute">
<dt id="pdpyras.APISession.default_page_size">
<code class="sig-name descname">default_page_size</code><em class="property"> = 100</em><a class="headerlink" href="#pdpyras.APISession.default_page_size" title="Permalink to this definition">¶</a></dt>
<dd><p>This will be the default number of results requested in each page when
iterating/querying an index (the <code class="docutils literal notranslate"><span class="pre">limit</span></code> parameter). See: <a class="reference external" href="https://v2.developer.pagerduty.com/docs/pagination">pagination</a>.</p>
</dd></dl>

<dl class="py method">
<dt id="pdpyras.APISession.dict_all">
<code class="sig-name descname">dict_all</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">path</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">kw</span></em><span class="sig-paren">)</span><a class="headerlink" href="#pdpyras.APISession.dict_all" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns a dictionary of all objects from a given index endpoint.</p>
<p>With the exception of <code class="docutils literal notranslate"><span class="pre">by</span></code>, all keyword arguments passed to this
method are also passed to <a class="reference internal" href="#pdpyras.APISession.iter_all" title="pdpyras.APISession.iter_all"><code class="xref py py-attr docutils literal notranslate"><span class="pre">iter_all</span></code></a>; see the documentation on
that method for further details.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>path</strong> – The index endpoint URL to use.</p></li>
<li><p><strong>by</strong> – The attribute of each object to use for the key values of the
dictionary. This is <code class="docutils literal notranslate"><span class="pre">id</span></code> by default. Please note, there is no
uniqueness validation, so if you use an attribute that is not
distinct for the data set, this function will omit some data in the
results.</p></li>
<li><p><strong>params</strong> – Additional URL parameters to include.</p></li>
<li><p><strong>paginate</strong> – If True, use <a class="reference external" href="https://v2.developer.pagerduty.com/docs/pagination">pagination</a> to get through all available results. If
False, ignore / don’t page through more than the first 100 results.
Useful for special index endpoints that don’t fully support
pagination yet, i.e. “nested” endpoints like
<code class="docutils literal notranslate"><span class="pre">/users/{id}/contact_methods</span></code> and <code class="docutils literal notranslate"><span class="pre">/services/{id}/integrations</span></code></p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="pdpyras.APISession.find">
<code class="sig-name descname">find</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">resource</span></em>, <em class="sig-param"><span class="n">query</span></em>, <em class="sig-param"><span class="n">attribute</span><span class="o">=</span><span class="default_value">'name'</span></em>, <em class="sig-param"><span class="n">params</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="headerlink" href="#pdpyras.APISession.find" title="Permalink to this definition">¶</a></dt>
<dd><p>Finds an object of a given resource exactly matching a query.</p>
<p>Will query a given <a class="reference external" href="https://v2.developer.pagerduty.com/docs/endpoints#resources-index">resource index</a> endpoint using the <code class="docutils literal notranslate"><span class="pre">query</span></code>
parameter supported by most indexes.</p>
<p>Returns a dict if a result is found. The structure will be that of an
entry in the index endpoint schema’s array of results. Otherwise, it
will return <cite>None</cite> if no result is found or an error is encountered.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>resource</strong> (<em>str</em>) – The name of the resource endpoint to query, i.e.
<code class="docutils literal notranslate"><span class="pre">escalation_policies</span></code></p></li>
<li><p><strong>query</strong> (<em>str</em>) – The string to query for in the the index.</p></li>
<li><p><strong>attribute</strong> (<em>str</em>) – The property of each result to compare against the query value when
searching for an exact match. By default it is <code class="docutils literal notranslate"><span class="pre">name</span></code>, but when
searching for user by email (for example) it can be set to <code class="docutils literal notranslate"><span class="pre">email</span></code></p></li>
<li><p><strong>params</strong> (<em>dict</em><em> or </em><em>None</em>) – Optional additional parameters to use when querying.</p></li>
</ul>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p>dict</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="pdpyras.APISession.iter_all">
<code class="sig-name descname">iter_all</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">path</span></em>, <em class="sig-param"><span class="n">params</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">paginate</span><span class="o">=</span><span class="default_value">True</span></em>, <em class="sig-param"><span class="n">page_size</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">item_hook</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">total</span><span class="o">=</span><span class="default_value">False</span></em><span class="sig-paren">)</span><a class="headerlink" href="#pdpyras.APISession.iter_all" title="Permalink to this definition">¶</a></dt>
<dd><p>Iterator for the contents of an index endpoint or query.</p>
<p>Automatically paginates and yields the results in each page, until all
matching results have been yielded or a HTTP error response is received.</p>
<p>Each yielded value is a dict object representing a result returned from
the index. For example, if requesting the <code class="docutils literal notranslate"><span class="pre">/users</span></code> endpoint, each
yielded value will be an entry of the <code class="docutils literal notranslate"><span class="pre">users</span></code> array property in the
response; see: <a class="reference external" href="https://v2.developer.pagerduty.com/v2/page/api-reference#!/Users/get_users">List Users</a></p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>path</strong> (<em>str</em>) – The index endpoint URL to use.</p></li>
<li><p><strong>params</strong> (<em>dict</em><em> or </em><em>None</em>) – Additional URL parameters to include.</p></li>
<li><p><strong>paginate</strong> (<em>bool</em>) – If True, use <a class="reference external" href="https://v2.developer.pagerduty.com/docs/pagination">pagination</a> to get through all available results. If
False, ignore / don’t page through more than the first 100 results.
Useful for special index endpoints that don’t fully support
pagination yet, i.e. “nested” endpoints like (as of this writing):
<code class="docutils literal notranslate"><span class="pre">/users/{id}/contact_methods</span></code> and <code class="docutils literal notranslate"><span class="pre">/services/{id}/integrations</span></code></p></li>
<li><p><strong>page_size</strong> (<em>int</em><em> or </em><em>None</em>) – If set, the <code class="docutils literal notranslate"><span class="pre">page_size</span></code> argument will override the <code class="docutils literal notranslate"><span class="pre">default_page_size</span></code> 
parameter on the session and set the <code class="docutils literal notranslate"><span class="pre">limit</span></code> parameter to a custom 
value (default is 100), altering the number of pagination results.</p></li>
<li><p><strong>item_hook</strong> – Callable object that will be invoked for each iteration, i.e. for
printing progress. It will be called with three parameters: a dict
representing a given result in the iteration, the number of the
item, and the total number of items in the series.</p></li>
<li><p><strong>total</strong> (<em>bool</em>) – If True, the <code class="docutils literal notranslate"><span class="pre">total</span></code> parameter will be included in API calls, and
the value for the third parameter to the item hook will be the total
count of records that match the query. Leaving this as False confers
a small performance advantage, as the API in this case does not have
to compute the total count of results in the query.</p></li>
</ul>
</dd>
<dt class="field-even">Yields</dt>
<dd class="field-even"><p>Results from the index endpoint.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>dict</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="pdpyras.APISession.list_all">
<code class="sig-name descname">list_all</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">path</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">kw</span></em><span class="sig-paren">)</span><a class="headerlink" href="#pdpyras.APISession.list_all" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns a list of all objects from a given index endpoint.</p>
<p>All keyword arguments passed to this function are also passed directly
to <a class="reference internal" href="#pdpyras.APISession.iter_all" title="pdpyras.APISession.iter_all"><code class="xref py py-attr docutils literal notranslate"><span class="pre">iter_all</span></code></a>; see the documentation on that method for details.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>path</strong> – The index endpoint URL to use.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="pdpyras.APISession.persist">
<code class="sig-name descname">persist</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">resource</span></em>, <em class="sig-param"><span class="n">attr</span></em>, <em class="sig-param"><span class="n">values</span></em><span class="sig-paren">)</span><a class="headerlink" href="#pdpyras.APISession.persist" title="Permalink to this definition">¶</a></dt>
<dd><p>Finds or creates and returns a resource matching an idempotency key.</p>
<p>Given a resource name, an attribute to use as an idempotency key and a
set of attribute:value pairs as a dict, create a resource with the
specified attributes if it doesn’t exist already and return the resource
persisted via the API (whether or not it already existed).</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>resource</strong> (<em>str</em>) – The resource name. Must be a valid API resource that is supported by
the <code class="docutils literal notranslate"><span class="pre">r*</span></code> methods; see <a class="reference internal" href="#supported-endpoints"><span class="std std-ref">Supported Endpoints</span></a>.</p></li>
<li><p><strong>attr</strong> (<em>str</em>) – Name of the attribute to use as the idempotency key. For instance,
“email” when the resource is “users” will not create the user if a
user with the email address given in <code class="docutils literal notranslate"><span class="pre">values</span></code> already exists.</p></li>
<li><p><strong>values</strong> (<em>dict</em>) – The content of the resource to be created, if it does not already
exist. This must contain an item with a key that is the same as the
<code class="docutils literal notranslate"><span class="pre">attr</span></code> argument.</p></li>
</ul>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p>dict</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="pdpyras.APISession.postprocess">
<code class="sig-name descname">postprocess</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">response</span></em>, <em class="sig-param"><span class="n">suffix</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="headerlink" href="#pdpyras.APISession.postprocess" title="Permalink to this definition">¶</a></dt>
<dd><p>Records performance information / request metadata about the API call.</p>
<p>This method is called automatically by <code class="xref py py-func docutils literal notranslate"><span class="pre">request()</span></code> for all requests,
and can be extended in child classes.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>method</strong> (<em>str</em>) – Method of the request</p></li>
<li><p><strong>response</strong> (<a class="reference external" href="https://2.python-requests.org/en/master/api/#requests.Response">requests.Response</a>) – Response object</p></li>
<li><p><strong>suffix</strong> (<em>str</em><em> or </em><em>None</em>) – Optional suffix to append to the key</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="pdpyras.APISession.prepare_headers">
<code class="sig-name descname">prepare_headers</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">method</span></em><span class="sig-paren">)</span><a class="headerlink" href="#pdpyras.APISession.prepare_headers" title="Permalink to this definition">¶</a></dt>
<dd><p>Append special additional per-request headers.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>method</strong> – The HTTP method, in upper case.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="pdpyras.APISession.profiler_key">
<code class="sig-name descname">profiler_key</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">method</span></em>, <em class="sig-param"><span class="n">path</span></em>, <em class="sig-param"><span class="n">suffix</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="headerlink" href="#pdpyras.APISession.profiler_key" title="Permalink to this definition">¶</a></dt>
<dd><p>Generates a fixed-format key to classify a request, i.e. for profiling.</p>
<p>Returns a string that will have all instances of IDs replaced with
<code class="docutils literal notranslate"><span class="pre">{id}</span></code>, and will begin with the method in lower case followed by a
colon, i.e. <code class="docutils literal notranslate"><span class="pre">get:escalation_policies/{id}</span></code></p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>method</strong> (<em>str</em>) – The request method</p></li>
<li><p><strong>path</strong> (<em>str</em>) – The path/URI to classify</p></li>
<li><p><strong>suffix</strong> (<em>str</em>) – Optional suffix to append to the key</p></li>
</ul>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p>str</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="pdpyras.APISession.subdomain">
<em class="property">property </em><code class="sig-name descname">subdomain</code><a class="headerlink" href="#pdpyras.APISession.subdomain" title="Permalink to this definition">¶</a></dt>
<dd><p>Subdomain of the PagerDuty account of the API access token.</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>str or None</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="pdpyras.APISession.total_call_count">
<em class="property">property </em><code class="sig-name descname">total_call_count</code><a class="headerlink" href="#pdpyras.APISession.total_call_count" title="Permalink to this definition">¶</a></dt>
<dd><p>The total number of API calls made by this instance.</p>
</dd></dl>

<dl class="py method">
<dt id="pdpyras.APISession.total_call_time">
<em class="property">property </em><code class="sig-name descname">total_call_time</code><a class="headerlink" href="#pdpyras.APISession.total_call_time" title="Permalink to this definition">¶</a></dt>
<dd><p>The total time spent making API calls.</p>
</dd></dl>

<dl class="py method">
<dt id="pdpyras.APISession.trunc_token">
<em class="property">property </em><code class="sig-name descname">trunc_token</code><a class="headerlink" href="#pdpyras.APISession.trunc_token" title="Permalink to this definition">¶</a></dt>
<dd><p>Truncated token for secure display/identification purposes.</p>
</dd></dl>

<dl class="py attribute">
<dt id="pdpyras.APISession.url">
<code class="sig-name descname">url</code><em class="property"> = 'https://api.pagerduty.com'</em><a class="headerlink" href="#pdpyras.APISession.url" title="Permalink to this definition">¶</a></dt>
<dd><p>Base URL of the REST API</p>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="events-api-client">
<h3>Events API Client<a class="headerlink" href="#events-api-client" title="Permalink to this headline">¶</a></h3>
<p>Class <code class="docutils literal notranslate"><span class="pre">EventsAPISession</span></code> implements methods for submitting events to
PagerDuty through the Events API and inherits from <a class="reference internal" href="#pdpyras.PDSession" title="pdpyras.PDSession"><code class="xref py py-class docutils literal notranslate"><span class="pre">pdpyras.PDSession</span></code></a>.</p>
<dl class="py class">
<dt id="pdpyras.EventsAPISession">
<em class="property">class </em><code class="sig-prename descclassname">pdpyras.</code><code class="sig-name descname">EventsAPISession</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">api_key</span></em>, <em class="sig-param"><span class="n">name</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="headerlink" href="#pdpyras.EventsAPISession" title="Permalink to this definition">¶</a></dt>
<dd><p>Session class for submitting events to the PagerDuty v2 Events API.</p>
<p>Provides methods for submitting events to the Events API.</p>
<p>Inherits from <a class="reference internal" href="#pdpyras.PDSession" title="pdpyras.PDSession"><code class="xref py py-class docutils literal notranslate"><span class="pre">PDSession</span></code></a>.</p>
<dl class="py method">
<dt id="pdpyras.EventsAPISession.acknowledge">
<code class="sig-name descname">acknowledge</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">dedup_key</span></em><span class="sig-paren">)</span><a class="headerlink" href="#pdpyras.EventsAPISession.acknowledge" title="Permalink to this definition">¶</a></dt>
<dd><p>Acknowledge an alert via Events API.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>dedup_key</strong> – The deduplication key of the alert to set to the acknowledged state.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="pdpyras.EventsAPISession.auth_header">
<em class="property">property </em><code class="sig-name descname">auth_header</code><a class="headerlink" href="#pdpyras.EventsAPISession.auth_header" title="Permalink to this definition">¶</a></dt>
<dd><p>Generates the header with the API credential used for authentication.</p>
</dd></dl>

<dl class="py method">
<dt id="pdpyras.EventsAPISession.prepare_headers">
<code class="sig-name descname">prepare_headers</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">method</span></em><span class="sig-paren">)</span><a class="headerlink" href="#pdpyras.EventsAPISession.prepare_headers" title="Permalink to this definition">¶</a></dt>
<dd><p>Add user agent and content type headers for Events API requests.</p>
</dd></dl>

<dl class="py method">
<dt id="pdpyras.EventsAPISession.resolve">
<code class="sig-name descname">resolve</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">dedup_key</span></em><span class="sig-paren">)</span><a class="headerlink" href="#pdpyras.EventsAPISession.resolve" title="Permalink to this definition">¶</a></dt>
<dd><p>Resolve an alert via Events API.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>dedup_key</strong> – The deduplication key of the alert to resolve.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="pdpyras.EventsAPISession.send_event">
<code class="sig-name descname">send_event</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">action</span></em>, <em class="sig-param"><span class="n">dedup_key</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">properties</span></em><span class="sig-paren">)</span><a class="headerlink" href="#pdpyras.EventsAPISession.send_event" title="Permalink to this definition">¶</a></dt>
<dd><p>Send an event to the v2 Events API.</p>
<p>See: <a class="reference external" href="https://v2.developer.pagerduty.com/docs/send-an-event-events-api-v2">https://v2.developer.pagerduty.com/docs/send-an-event-events-api-v2</a></p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>action</strong> (<em>str</em>) – The action to perform through the Events API: trigger, acknowledge
or resolve.</p></li>
<li><p><strong>dedup_key</strong> (<em>str</em>) – The deduplication key; used for determining event uniqueness and
associating actions with existing incidents.</p></li>
<li><p><strong>**properties</strong> – Additional properties to set, i.e. if <code class="docutils literal notranslate"><span class="pre">action</span></code> is <code class="docutils literal notranslate"><span class="pre">trigger</span></code>
this would include <code class="docutils literal notranslate"><span class="pre">payload</span></code></p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>The deduplication key of the incident, if any.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="pdpyras.EventsAPISession.trigger">
<code class="sig-name descname">trigger</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">summary</span></em>, <em class="sig-param"><span class="n">source</span></em>, <em class="sig-param"><span class="n">dedup_key</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">severity</span><span class="o">=</span><span class="default_value">'critical'</span></em>, <em class="sig-param"><span class="n">payload</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">custom_details</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">images</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">links</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="headerlink" href="#pdpyras.EventsAPISession.trigger" title="Permalink to this definition">¶</a></dt>
<dd><p>Trigger an incident</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>summary</strong> (<em>str</em>) – Summary / brief description of what is wrong.</p></li>
<li><p><strong>source</strong> (<em>str</em>) – A human-readable name identifying the system that is affected.</p></li>
<li><p><strong>dedup_key</strong> (<em>str</em>) – The deduplication key; used for determining event uniqueness and
associating actions with existing incidents.</p></li>
<li><p><strong>severity</strong> (<em>str</em>) – Alert severity. Sets the <code class="docutils literal notranslate"><span class="pre">payload.severity</span></code> property.</p></li>
<li><p><strong>payload</strong> (<em>dict</em>) – Set the payload directly. Can be used in conjunction with other
parameters that also set payload properties; these properties will
be merged into the default payload, and any properties in this
parameter will take precedence except with regard to
<code class="docutils literal notranslate"><span class="pre">custom_details</span></code>.</p></li>
<li><p><strong>custom_details</strong> (<em>dict</em>) – The <code class="docutils literal notranslate"><span class="pre">payload.custom_details</span></code> property of the payload. Will
override the property set in the <code class="docutils literal notranslate"><span class="pre">payload</span></code> parameter if given.</p></li>
<li><p><strong>images</strong> (<em>list</em>) – Set the <code class="docutils literal notranslate"><span class="pre">images</span></code> property of the event.</p></li>
<li><p><strong>links</strong> (<em>list</em>) – Set the <code class="docutils literal notranslate"><span class="pre">links</span></code> property of the event.</p></li>
</ul>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p>str</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="id2">
<h3>Errors<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h3>
<dl class="py class">
<dt id="pdpyras.PDClientError">
<em class="property">class </em><code class="sig-prename descclassname">pdpyras.</code><code class="sig-name descname">PDClientError</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">message</span></em>, <em class="sig-param"><span class="n">response</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="headerlink" href="#pdpyras.PDClientError" title="Permalink to this definition">¶</a></dt>
<dd><p>General API errors base class.</p>
<dl class="py attribute">
<dt id="pdpyras.PDClientError.response">
<code class="sig-name descname">response</code><em class="property"> = None</em><a class="headerlink" href="#pdpyras.PDClientError.response" title="Permalink to this definition">¶</a></dt>
<dd><p>The HTTP response object, if a response was successfully received.</p>
<p>In the case of network errors, this property will be None.</p>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="module-pdpyras">
<span id="functions"></span><h3>Functions<a class="headerlink" href="#module-pdpyras" title="Permalink to this headline">¶</a></h3>
<dl class="py function">
<dt id="pdpyras.auto_json">
<code class="sig-prename descclassname">pdpyras.</code><code class="sig-name descname">auto_json</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">method</span></em><span class="sig-paren">)</span><a class="headerlink" href="#pdpyras.auto_json" title="Permalink to this definition">¶</a></dt>
<dd><p>Function decorator that makes methods return the full response JSON</p>
</dd></dl>

<dl class="py function">
<dt id="pdpyras.last_4">
<code class="sig-prename descclassname">pdpyras.</code><code class="sig-name descname">last_4</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">secret</span></em><span class="sig-paren">)</span><a class="headerlink" href="#pdpyras.last_4" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns an abbreviation of the input</p>
</dd></dl>

<dl class="py function">
<dt id="pdpyras.object_type">
<code class="sig-prename descclassname">pdpyras.</code><code class="sig-name descname">object_type</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">r_name</span></em><span class="sig-paren">)</span><a class="headerlink" href="#pdpyras.object_type" title="Permalink to this definition">¶</a></dt>
<dd><p>Derives an object type (i.e. <code class="docutils literal notranslate"><span class="pre">user</span></code>) from a resource name (i.e. <code class="docutils literal notranslate"><span class="pre">users</span></code>)</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>r_name</strong> – Resource name, i.e. would be <code class="docutils literal notranslate"><span class="pre">users</span></code> for the resource index URL
<code class="docutils literal notranslate"><span class="pre">https://api.pagerduty.com/users</span></code></p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>The object type name; usually the <code class="docutils literal notranslate"><span class="pre">type</span></code> property of an instance
of the given resource.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>str</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="pdpyras.raise_on_error">
<code class="sig-prename descclassname">pdpyras.</code><code class="sig-name descname">raise_on_error</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">r</span></em><span class="sig-paren">)</span><a class="headerlink" href="#pdpyras.raise_on_error" title="Permalink to this definition">¶</a></dt>
<dd><p>Raise an exception if a HTTP error response has error status.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>r</strong> (<a class="reference external" href="https://2.python-requests.org/en/master/api/#requests.Response">requests.Response</a>) – Response object corresponding to the response received.</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>The response object, if its status was success</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><a class="reference external" href="https://2.python-requests.org/en/master/api/#requests.Response">requests.Response</a></p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="pdpyras.random">
<code class="sig-prename descclassname">pdpyras.</code><code class="sig-name descname">random</code><span class="sig-paren">(</span><span class="sig-paren">)</span> &#x2192; x in the interval [0, 1).<a class="headerlink" href="#pdpyras.random" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt id="pdpyras.resource_envelope">
<code class="sig-prename descclassname">pdpyras.</code><code class="sig-name descname">resource_envelope</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">method</span></em><span class="sig-paren">)</span><a class="headerlink" href="#pdpyras.resource_envelope" title="Permalink to this definition">¶</a></dt>
<dd><p>Convenience and consistency decorator for HTTP verb functions.</p>
<p>This makes the request methods <code class="docutils literal notranslate"><span class="pre">GET</span></code>, <code class="docutils literal notranslate"><span class="pre">POST</span></code> and <code class="docutils literal notranslate"><span class="pre">PUT</span></code> always return a
dictionary object representing the resource at the envelope property (i.e.
the <code class="docutils literal notranslate"><span class="pre">{...}</span></code> from <code class="docutils literal notranslate"><span class="pre">{&quot;escalation_policy&quot;:{...}}</span></code> in a get/put request to
an escalation policy)  rather than a <a class="reference external" href="https://2.python-requests.org/en/master/api/#requests.Response">requests.Response</a> object.</p>
<p>Methods using this decorator will raise a <a class="reference internal" href="#pdpyras.PDClientError" title="pdpyras.PDClientError"><code class="xref py py-class docutils literal notranslate"><span class="pre">PDClientError</span></code></a> with its
<code class="docutils literal notranslate"><span class="pre">response</span></code> property being being the <a class="reference external" href="https://2.python-requests.org/en/master/api/#requests.Response">requests.Response</a> object in the
case of any error, so that the implementer can access it by catching the
exception, and thus design their own custom logic around different types of
error responses.</p>
<p>It allows creation of methods that can provide more succinct ways of making
API calls. In particular, the methods using this decorator don’t require
checking for a success status, JSON-decoding the response body and then
pulling the essential data out of the envelope (i.e. for <code class="docutils literal notranslate"><span class="pre">GET</span>
<span class="pre">/escalation_policies/{id}</span></code> one would have to access the
<code class="docutils literal notranslate"><span class="pre">escalation_policy</span></code> property of the object decoded from the response body,
assuming nothing went wrong in the whole process).</p>
<p>These methods are <a class="reference internal" href="#pdpyras.APISession.rget" title="pdpyras.APISession.rget"><code class="xref py py-attr docutils literal notranslate"><span class="pre">APISession.rget</span></code></a>, <a class="reference internal" href="#pdpyras.APISession.rpost" title="pdpyras.APISession.rpost"><code class="xref py py-attr docutils literal notranslate"><span class="pre">APISession.rpost</span></code></a> and
<a class="reference internal" href="#pdpyras.APISession.rput" title="pdpyras.APISession.rput"><code class="xref py py-attr docutils literal notranslate"><span class="pre">APISession.rput</span></code></a>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>method</strong> – Method being decorated. Must take one positional argument
after <code class="docutils literal notranslate"><span class="pre">self</span></code> that is the URL/path to the resource, and must return an
object of class <a class="reference external" href="https://2.python-requests.org/en/master/api/#requests.Response">requests.Response</a>, and be named after the HTTP method
but with “r” prepended.</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>A callable object; the reformed method</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="pdpyras.resource_name">
<code class="sig-prename descclassname">pdpyras.</code><code class="sig-name descname">resource_name</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">obj_type</span></em><span class="sig-paren">)</span><a class="headerlink" href="#pdpyras.resource_name" title="Permalink to this definition">¶</a></dt>
<dd><p>Transforms an object type into a resource name</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>obj_type</strong> – The object type, i.e. <code class="docutils literal notranslate"><span class="pre">user</span></code> or <code class="docutils literal notranslate"><span class="pre">user_reference</span></code></p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>The name of the resource, i.e. the last part of the URL for the
resource’s index URL</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>str</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="pdpyras.resource_path">
<code class="sig-prename descclassname">pdpyras.</code><code class="sig-name descname">resource_path</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">method</span></em><span class="sig-paren">)</span><a class="headerlink" href="#pdpyras.resource_path" title="Permalink to this definition">¶</a></dt>
<dd><p>API call decorator that allows passing a resource dict as the path/URL</p>
<p>Most resources returned by the API will contain a <code class="docutils literal notranslate"><span class="pre">self</span></code> attribute that is
the URL of the resource itself.</p>
<p>Using this decorator allows the implementer to pass either a URL/path or
such a resource dictionary as the <code class="docutils literal notranslate"><span class="pre">path</span></code> argument, thus eliminating the
need to re-construct the resource URL or hold it in a temporary variable.</p>
</dd></dl>

<dl class="py function">
<dt id="pdpyras.tokenize_url_path">
<code class="sig-prename descclassname">pdpyras.</code><code class="sig-name descname">tokenize_url_path</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">url</span></em>, <em class="sig-param"><span class="n">baseurl</span><span class="o">=</span><span class="default_value">'https://api.pagerduty.com'</span></em><span class="sig-paren">)</span><a class="headerlink" href="#pdpyras.tokenize_url_path" title="Permalink to this definition">¶</a></dt>
<dd><p>Classifies a URL according to some global patterns in the API.</p>
<p>If the URL is to access a specific individual resource by ID, the node type
will be identified as <code class="docutils literal notranslate"><span class="pre">{id}</span></code>, whereas if it is an index, it will be
identified as <code class="docutils literal notranslate"><span class="pre">{index}</span></code>.</p>
<p>For instance, <code class="docutils literal notranslate"><span class="pre">https://api.pagerduty.com/users</span></code> would be classified as
<code class="docutils literal notranslate"><span class="pre">(&quot;users&quot;,</span> <span class="pre">&quot;{index}&quot;)</span></code>, and <code class="docutils literal notranslate"><span class="pre">https://api.pagerduty.com/users/PABC123</span></code>
would be classified as <code class="docutils literal notranslate"><span class="pre">(&quot;users&quot;,</span> <span class="pre">&quot;{id}&quot;)</span></code></p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>url</strong> (<em>str</em>) – The URL (or path) to be classified; the function should accept either</p></li>
<li><p><strong>baseurl</strong> (<em>str</em>) – API base URL</p></li>
</ul>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p>tuple</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="pdpyras.try_decoding">
<code class="sig-prename descclassname">pdpyras.</code><code class="sig-name descname">try_decoding</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">r</span></em><span class="sig-paren">)</span><a class="headerlink" href="#pdpyras.try_decoding" title="Permalink to this definition">¶</a></dt>
<dd><p>JSON-decode a response body and raise <a class="reference internal" href="#pdpyras.PDClientError" title="pdpyras.PDClientError"><code class="xref py py-class docutils literal notranslate"><span class="pre">PDClientError</span></code></a> if it fails.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>r</strong> – <a class="reference external" href="https://2.python-requests.org/en/master/api/#requests.Response">requests.Response</a> object</p>
</dd>
</dl>
</dd></dl>

</div>
</div>
<div class="section" id="changelog">
<h2>Changelog<a class="headerlink" href="#changelog" title="Permalink to this headline">¶</a></h2>
<p><strong>2021-03-02: Version 4.1.3</strong></p>
<ul class="simple">
<li><p>Add warning for Python 2.7</p></li>
</ul>
<p><strong>2020-09-15: Version 4.1.2</strong></p>
<ul class="simple">
<li><dl class="simple">
<dt>Address issue #37 and add other enhancements to <code class="docutils literal notranslate"><span class="pre">iter_all</span></code>:</dt><dd><ul>
<li><p>Stop iteration in <code class="docutils literal notranslate"><span class="pre">iter_all</span></code> if the iteration limit (10000) is encountered, versus erroring out (because exceeding it will elicit a 400 response)</p></li>
<li><p>Add the ability to set an initial offset via <code class="docutils literal notranslate"><span class="pre">params</span></code> versus always starting from <code class="docutils literal notranslate"><span class="pre">offset=0</span></code> in <code class="docutils literal notranslate"><span class="pre">iter_all</span></code></p></li>
</ul>
</dd>
</dl>
</li>
<li><p>Capitalize “constants”</p></li>
</ul>
<p><strong>2020-06-26: Version 4.1.1</strong></p>
<ul class="simple">
<li><p>Define class variable <code class="docutils literal notranslate"><span class="pre">retry</span></code> initially as <code class="docutils literal notranslate"><span class="pre">{}</span></code> instead of <code class="docutils literal notranslate"><span class="pre">None</span></code> (<a class="reference external" href="https://github.com/PagerDuty/pdpyras/issues/32">#32</a>)</p></li>
</ul>
<p><strong>2020-03-08: Version: 4.1</strong></p>
<ul class="simple">
<li><p>Added new idempotent resource creator function, <a class="reference internal" href="#pdpyras.APISession.persist" title="pdpyras.APISession.persist"><code class="xref py py-attr docutils literal notranslate"><span class="pre">APISession.persist</span></code></a></p></li>
<li><p>Added the ability to use resource dictionaries (that have a <code class="docutils literal notranslate"><span class="pre">self</span></code> attribute) in place of URLs.</p></li>
</ul>
<p><strong>2020-02-04: Version 4.0</strong></p>
<ul class="simple">
<li><p>Added support for using OAuth 2 access tokens to authenticate (<a class="reference external" href="https://github.com/PagerDuty/pdpyras/issues/23">#23</a>)</p></li>
<li><p>Added a property that indicates the access level/scope of a given API credential (<a class="reference external" href="https://github.com/PagerDuty/pdpyras/issues/22">#22</a>)</p></li>
</ul>
<p><strong>2020-01-10: version 3.2.1</strong></p>
<ul class="simple">
<li><p>Fixed bug in <a class="reference internal" href="#pdpyras.APISession.trunc_token" title="pdpyras.APISession.trunc_token"><code class="xref py py-attr docutils literal notranslate"><span class="pre">APISession.trunc_token</span></code></a>; property name typo causes <code class="docutils literal notranslate"><span class="pre">AttributeError</span></code></p></li>
</ul>
<p><strong>2019-10-31: version 3.2</strong></p>
<ul class="simple">
<li><p>The page size (<code class="docutils literal notranslate"><span class="pre">limit</span></code>) parameter can now be set on a per-call basis in any of the <code class="docutils literal notranslate"><span class="pre">*_all</span></code> methods (i.e. <code class="xref py py-attr docutils literal notranslate"><span class="pre">PDSession.iter_all</span></code>) by passing the <code class="docutils literal notranslate"><span class="pre">page_size</span></code> keyword argument. If the argument is not present, the default page size will be used.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">X-Request-Id</span></code> header in responses is now captured in log messages to make it easier to identify API calls when communicating with PagerDuty Support</p></li>
<li><p>Extended API call metadata is also now logged.</p></li>
<li><p>The cooldown time between rate limit responses can optionally be randomized by setting <a class="reference internal" href="#pdpyras.PDSession.stagger_cooldown" title="pdpyras.PDSession.stagger_cooldown"><code class="xref py py-attr docutils literal notranslate"><span class="pre">PDSession.stagger_cooldown</span></code></a> to a positive number.</p></li>
</ul>
<p><strong>2019-10-01: version 3.1.2</strong></p>
<ul class="simple">
<li><p>Fixed regression bug / departure from documentation (#17): the <code class="docutils literal notranslate"><span class="pre">payload</span></code> parameter does not merge with but rather completely replaces the default payload</p></li>
</ul>
<p><strong>2019-04-05: version 3.1.1</strong></p>
<ul class="simple">
<li><dl class="simple">
<dt>Changed behavior of HTTP retry that caused issues with some internal tools: raising <code class="docutils literal notranslate"><span class="pre">PDClientError</span></code> in the event of non-transient HTTP error, in the <code class="docutils literal notranslate"><span class="pre">request</span></code> method, versus returning the request object and logging it. The previous behavior was:</dt><dd><ul>
<li><p>Not the intended design</p></li>
<li><p>At odds with the documentated behavior</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
<p><strong>2019-04-05: version 3.1:</strong></p>
<ul class="simple">
<li><p>Introduction of a custom <code class="docutils literal notranslate"><span class="pre">User-Agent</span></code> header to distinguish the API client as such, for the purposes of usage analytics</p></li>
</ul>
<p><strong>2019-04-02: version 3.0.2:</strong></p>
<p>Important bug fixes to the custom HTTP retry logic:</p>
<ul class="simple">
<li><p>Fixed <code class="docutils literal notranslate"><span class="pre">KeyError</span></code> in <code class="docutils literal notranslate"><span class="pre">APISession.request</span></code></p></li>
<li><p>Fixed incorrect behavior (retrying more than the specified amount of times) due to faulty comparison logic</p></li>
</ul>
<p><strong>2019-03-14: version 3.0.1:</strong></p>
<p>A light Events API client methods refactor:</p>
<ul class="simple">
<li><p>All keyword arguments specific to sending trigger events have been refactored out of the generic <code class="docutils literal notranslate"><span class="pre">EventsAPISession.send_event</span></code> method</p></li>
<li><p>Now, instead, <code class="docutils literal notranslate"><span class="pre">send_event</span></code> and uses a catch-all keyword argument to set event properties.</p></li>
<li><p>The keyword arguments specific to triggering incidents are in the method EventsAPISession.trigger method.</p></li>
</ul>
<p><strong>2019-03-12: version 3.0:</strong></p>
<ul class="simple">
<li><p>Added new Events API session class that still has most of the same functional features as the REST API session class.</p></li>
</ul>
<p><strong>2019-01-28: version 2.4.1:</strong></p>
<ul class="simple">
<li><p>Fixed bug: unpacking wrapped entities does not work with <code class="docutils literal notranslate"><span class="pre">/log_entries</span></code></p></li>
</ul>
<p><strong>2019-01-10: version 2.4:</strong></p>
<ul class="simple">
<li><p>Whitelisting of endpoints supported by the <code class="docutils literal notranslate"><span class="pre">r*</span></code> / <code class="docutils literal notranslate"><span class="pre">*_all</span></code> methods has been rescinded, and documentation has been updated with how to identify endpoints that these methods can be used with.</p></li>
</ul>
<p><strong>2019-01-03: version 2.3:</strong></p>
<ul class="simple">
<li><p>More helpful error messaging when using <code class="docutils literal notranslate"><span class="pre">r*</span></code> / <code class="docutils literal notranslate"><span class="pre">*_all</span></code> methods on endpoints they don’t support</p></li>
<li><p>Resource envelope auto-unpacking no longer validates for the presence of a <code class="docutils literal notranslate"><span class="pre">type</span></code> property in order to support posting to business impact metrics</p></li>
</ul>
<p><strong>2018-12-04: version 2.2:</strong></p>
<ul class="simple">
<li><p>Methods <code class="docutils literal notranslate"><span class="pre">list_all</span></code> and <code class="docutils literal notranslate"><span class="pre">dict_all</span></code> turn all results from an index into a list/dict to save a bit of effort</p></li>
</ul>
<p><strong>2018-11-28: version 2.1:</strong></p>
<ul class="simple">
<li><p>Support for performing multi-update actions (i.e. <em>Manage Incidents</em>) via the <code class="docutils literal notranslate"><span class="pre">rput</span></code> method.</p></li>
<li><p>The default behavior of <code class="docutils literal notranslate"><span class="pre">iter_all</span></code> is now to raise an exception if an error response is received from the API during iteration.</p></li>
</ul>
<p><strong>Changelog Started 2018-11-28</strong></p>
</div>
</div>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="#">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">PDPYRAS: PagerDuty Python REST API Sessions</a><ul>
<li><a class="reference internal" href="#about">About</a><ul>
<li><a class="reference internal" href="#features">Features</a></li>
<li><a class="reference internal" href="#history">History</a></li>
<li><a class="reference internal" href="#copyright">Copyright</a></li>
<li><a class="reference internal" href="#warranty">Warranty</a></li>
</ul>
</li>
<li><a class="reference internal" href="#installation">Installation</a></li>
<li><a class="reference internal" href="#usage-guide">Usage Guide</a><ul>
<li><a class="reference internal" href="#basic-usage">Basic Usage</a></li>
<li><a class="reference internal" href="#using-an-oauth-2-access-token-to-authenticate">Using an OAuth 2 Access Token to Authenticate</a></li>
<li><a class="reference internal" href="#general-concepts">General Concepts</a><ul>
<li><a class="reference internal" href="#urls">URLs</a></li>
<li><a class="reference internal" href="#request-and-response-bodies">Request and Response Bodies</a></li>
<li><a class="reference internal" href="#using-special-features-of-requests">Using Special Features of Requests</a></li>
</ul>
</li>
<li><a class="reference internal" href="#data-access-abstraction">Data Access Abstraction</a><ul>
<li><a class="reference internal" href="#supported-endpoints">Supported Endpoints</a></li>
<li><a class="reference internal" href="#iteration">Iteration</a></li>
<li><a class="reference internal" href="#disclaimers-regarding-iteration">Disclaimers Regarding Iteration</a></li>
<li><a class="reference internal" href="#reading">Reading</a></li>
<li><a class="reference internal" href="#creating-and-updating">Creating and Updating</a></li>
<li><a class="reference internal" href="#idempotent-resource-creation">Idempotent Resource Creation</a></li>
<li><a class="reference internal" href="#deleting">Deleting</a></li>
<li><a class="reference internal" href="#managing-a-k-a-multi-updating">Managing, a.k.a. Multi-Updating</a></li>
<li><a class="reference internal" href="#using-resources-in-place-of-urls">Using Resources in Place of URLs</a></li>
</ul>
</li>
<li><a class="reference internal" href="#error-handling">Error Handling</a></li>
<li><a class="reference internal" href="#http-retry-logic">HTTP Retry Logic</a></li>
<li><a class="reference internal" href="#events-api-usage">Events API Usage</a></li>
</ul>
</li>
<li><a class="reference internal" href="#contributing">Contributing</a></li>
<li><a class="reference internal" href="#developer-interface">Developer Interface</a><ul>
<li><a class="reference internal" href="#generic-api-client">Generic API Client</a></li>
<li><a class="reference internal" href="#rest-api-client">REST API Client</a></li>
<li><a class="reference internal" href="#events-api-client">Events API Client</a></li>
<li><a class="reference internal" href="#id2">Errors</a></li>
<li><a class="reference internal" href="#module-pdpyras">Functions</a></li>
</ul>
</li>
<li><a class="reference internal" href="#changelog">Changelog</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2018, PagerDuty Inc..
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 3.2.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="_sources/index.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>